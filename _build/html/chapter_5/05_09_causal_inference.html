
<!DOCTYPE html>


<html lang="it" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Inferenza causale &#8212; ds4p</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/proof.css?v=ca93fcec" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css?v=20b57f81" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=8d586cc4"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/translations.js?v=0173e136"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-TP2WLBPMS6"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TP2WLBPMS6');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-TP2WLBPMS6');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter_5/05_09_causal_inference';</script>
    <link rel="canonical" href="https://ccaudek.github.io/ds4p/chapter_5/05_09_causal_inference.html" />
    <link rel="icon" href="../_static/increasing.png"/>
    <link rel="index" title="Indice" href="../genindex.html" />
    <link rel="search" title="Cerca" href="../search.html" />
    <link rel="next" title="✏️ Esercizi" href="E_causal_inference.html" />
    <link rel="prev" title="Errore di specificazione" href="05_08_specification_error.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="it"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="ds4p - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="ds4p - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Cerca" aria-label="Cerca" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Cerca</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Benvenuti
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_1/introduction_chapter_1.html">Python</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/00_prelims.html">Preliminari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/01_python_1.html">Python (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/02_python_2.html">Python (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/ex_python.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/03_numpy.html">NumPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/ex_numpy.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/04_pandas.html">Pandas (1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/05_pandas_aggregate.html">Pandas (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/06_pandas_functions.html">Pandas (3)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/ex_pandas.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/07_matplotlib.html">Matplotlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/08_seaborn.html">Seaborn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_1/ex_matplotlib.html">✏️ Esercizi</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_2/introduction_chapter_2.html">Statistica descrittiva</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/00_scientific_method.html">La scienza dei dati e il metodo scientifico</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/01_key_notions.html">Concetti chiave</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/E_key_notions.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/02_measurement.html">La misurazione in psicologia</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/E_scales.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/03_freq_distr.html">Dati e frequenze</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/E_sums.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/04_loc_scale.html">Indici di posizione e di scala</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/05_correlation.html">Le relazioni tra variabili</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/06_causality.html">Lo studio delle cause dei fenomeni</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/E_eda.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_2/E_mehr_song_spelke.html">✏️ Esercizi</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_3/introduction_chapter_3.html">Probabilità</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/01_intro_prob.html">Introduzione al calcolo delle probabilità</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_prob.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/02_conditional_prob.html">Probabilità condizionata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_cond_prob_1.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_cond_prob_2.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_discrete_prob.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/03_bayes_theorem.html">Il teorema di Bayes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_bayes_theorem.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_bayes_theorem_2.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/04a_random_var.html">Introduzione alle variabili casuali</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/04b_expval_var.html">Proprietà delle variabili casuali</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_exp_val_variance.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/04c_sampling_distr.html">Stime, stimatori e parametri</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_rv_discrete.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/05_joint_prob.html">Probabilità congiunta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_joint_prob.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_covariance.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/06_density_func.html">La funzione di densità di probabilità</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/07_discr_rv_distr.html">Distribuzioni di v.c. discrete</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_binomial.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/08_cont_rv_distr.html">Distribuzioni di v.c. continue</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_gaussian.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_beta_distr.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/09_likelihood.html">La verosimiglianza</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_3/E_likelihood.html">✏️ Esercizi</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_4/introduction_part_4.html">Inferenza bayesiana</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/01_intro_bayes.html">Modellazione bayesiana</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/02_subj_prop.html">Pensare ad una proporzione in termini soggettivi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/02_grid_gauss.html">Verosimiglianza Gaussiana: Metodo Basato su Griglia</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/03_conjugate_families_1.html">Distribuzioni coniugate</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/E_conjugate_families_1.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/04_conjugate_families_2.html">Distribuzioni coniugate (2)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/05_summary_posterior.html">Sintesi a posteriori</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/E_conjugate.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/06_balance-prior-post.html">L’influenza della distribuzione a priori</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/10_metropolis.html">Monte Carlo a Catena di Markov</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/15_stan_beta_binomial.html">Introduzione a Stan</a></li>

<li class="toctree-l2"><a class="reference internal" href="../chapter_4/E_stan_beta_binomial.html">✏️ Esercizio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/16_stan_summary_posterior.html">Metodi di sintesi della distribuzione a posteriori</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/17_stan_diagnostics.html">Diagnostica delle catene markoviane</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/18_stan_prediction.html">La predizione bayesiana</a></li>

<li class="toctree-l2"><a class="reference internal" href="../chapter_4/19_stan_odds_ratio.html">Analisi bayesiana dell’odds-ratio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/22_stan_normal_normal.html">Inferenza bayesiana su una media</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/23_stan_two_groups.html">Confronto tra due gruppi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_4/24_stan_hier_beta_binom.html">Modello gerarchico beta-binomiale con Stan</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="introduction_part_5.html">Analisi della regressione</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="05_03_reglin_bayesian.html">Analisi bayesiana del modello di regressione lineare bivariato</a></li>
<li class="toctree-l2"><a class="reference internal" href="E_reglin_1.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_04_synt_sugar.html">Zucchero sintattico</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_05_two_means.html">Confronto tra le medie di due gruppi</a></li>
<li class="toctree-l2"><a class="reference internal" href="E_reglin_2.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="E_reglin_3.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="E_reglin_4.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_06_hier_regr.html">Il modello lineare gerarchico</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_07_robust_regr.html">Regressione robusta</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_08_specification_error.html">Errore di specificazione</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Inferenza causale</a></li>
<li class="toctree-l2"><a class="reference internal" href="E_causal_inference.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_21_stan_binomial_regr.html">Regressione binomiale con Stan</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_24_stan_mixed_models.html">Modelli misti con Stan</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_25_stan_rct.html">Incorporare dati storici di controllo in una RCT</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_26_stan_mediation.html">Modello di mediazione con Stan</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_30_entropy.html">Entropia</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_31_kl.html">La divergenza di Kullback-Leibler</a></li>
<li class="toctree-l2"><a class="reference internal" href="E_kl.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_32_stan_loo.html">Validazione Incrociata Leave-One-Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_35_missing.html">Dati mancanti</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_6/introduction_part_6.html">Inferenza frequentista</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/01_intro_frequentist.html">Introduzione all’inferenza frequentista</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_estimation.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/02_conf_interv.html">Intervallo di confidenza</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_conf_interv.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/03_test_ipotesi.html">Significatività statistica</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_t_test.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_interpretation_test.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_significato_test.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/04_two_ind_samples.html">Test t di Student per campioni indipendenti</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_test_media_pop.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_medie_pop_ampie.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_medie_pop_piccoli.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_campioni_appaiati.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/E_confronto_proporzioni.html">✏️ Esercizi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/05_crisis.html">La crisi della generalizzabilità</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/06_limiti_stat_frequentista.html">Limiti dell’inferenza frequentista</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/07_effect_size.html">La grandezza dell’effetto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/09_s_m_errors.html">Crisi della replicabilità</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_6/10_integrity.html">Integrità della ricerca</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../references/bibliography.html">Bibliografia</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapter_7/introduction_appendix.html">Appendici</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a00_installation.html">Ambiente di lavoro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a01_markdown.html">Jupyter Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a02_shell.html">La Shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a03_colab_tutorial.html">Colab: un breve tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a04_virtual_env.html">Ambienti virtuali</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a10_math_symbols.html">Simbologia di base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a11_numbers.html">Numeri binari, interi, razionali, irrazionali e reali</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a12_sum_notation.html">Simbolo di somma (sommatorie)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a13_sets.html">Insiemi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a13a_probability.html">Sigma algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a14_combinatorics.html">Calcolo combinatorio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a15_calculus.html">Per liberarvi dai terrori preliminari</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a20_kde_plot.html">Kernel Density Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a30_prob_tutorial.html">Esercizi di probabilità discreta</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a40_rng.html">Generazione di numeri casuali</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a44_montecarlo.html">Simulazione Monte Carlo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a45_mcmc.html">Catene di Markov</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a46_stan.html">Linguaggio Stan</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a50_lin_fun.html">La funzione lineare</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a50_reglin_ml.html">Modello di Regressione Bivariato e ML</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a51_reglin_1.html">Regressione lineare bivariata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a60_ttest_exercises.html">Esercizi sull’inferenza frequentista</a></li>
<li class="toctree-l2"><a class="reference internal" href="../chapter_7/a70_predict_counts.html">La predizione delle frequenze</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/ccaudek/ds4p/blob/main/docs/chapter_5/05_09_causal_inference.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Scarica questa pagina">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/chapter_5/05_09_causal_inference.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Scarica il file sorgente"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Stampa in PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Modalità schermo intero"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Cerca" aria-label="Cerca" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Inferenza causale</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenuti </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparazione-del-notebook">Preparazione del Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scopi-della-regressione">Scopi della regressione</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modello-di-regressione-e-analisi-causale">Modello di Regressione e Analisi Causale</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#esempio-1-catena">Esempio 1: Catena</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#esempio-2-biforcazione">Esempio 2: Biforcazione</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#riflessioni-sulle-simulazioni-di-lubke2020we">Riflessioni sulle Simulazioni di <span class="xref cite cite-t">lubke2020we</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#l-inferenza-causale-va-oltre-la-statistica">L’Inferenza Causale Va Oltre la Statistica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#il-criterio-del-backdoor">Il Criterio del Backdoor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#il-quartetto-causale">Il Quartetto Causale</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#collider">Collider</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modello-di-regressione-y-x">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modello-di-regressione-y-x-z">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confounder">Confounder</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mediazione">Mediazione</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obiettivo-dell-analisi">Obiettivo dell’analisi</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applicazione-del-criterio-backdoor">Applicazione del Criterio Backdoor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#considerazioni-pratiche">Considerazioni Pratiche</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#causal-m-bias">Causal M-bias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#riflessioni-conclusive">Riflessioni conclusive</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#esercizio">Esercizio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#informazioni-sull-ambiente-di-sviluppo">Informazioni sull’Ambiente di Sviluppo</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="inferenza-causale">
<span id="causal-inference-notebook"></span><h1>Inferenza causale<a class="headerlink" href="#inferenza-causale" title="Link to this heading">#</a></h1>
<p>Lo scopo di questo capitolo è di introdurre il modello di regressione multipla e di discutere come esso si collega all’analisi causale.</p>
<section id="preparazione-del-notebook">
<h2>Preparazione del Notebook<a class="headerlink" href="#preparazione-del-notebook" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">arviz</span> <span class="k">as</span> <span class="nn">az</span>
<span class="kn">import</span> <span class="nn">bambi</span> <span class="k">as</span> <span class="nn">bmb</span>
<span class="kn">import</span> <span class="nn">graphviz</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set seed to make the results fully reproducible</span>
<span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span> <span class="s2">&quot;regr_causal_inference&quot;</span><span class="p">))</span>
<span class="n">rng</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">az</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;arviz-darkgrid&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.dpi&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.facecolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span>

<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &quot;retina&quot;
</pre></div>
</div>
</div>
</div>
<p>Il modello di regressione multipla è un concetto fondamentale nell’ambito della statistica e dell’analisi dei dati. Si tratta di un’estensione del modello di regressione bivariato che permette di includere più predittori nel modello. Questo significa che, invece di considerare solo una variabile indipendente per predire una variabile dipendente, ora abbiamo più predittori.</p>
<p>Nel modello di regressione multipla, la variabile dipendente, che chiameremo <span class="math notranslate nohighlight">\(Y\)</span>, viene predetta prendendo in considerazione la presenza di molteplici variabili indipendenti, che chiameremo <span class="math notranslate nohighlight">\(X_1, X_2, \ldots, X_p\)</span>. Il modello assume che il valore atteso di <span class="math notranslate nohighlight">\(Y\)</span> condizionato alle variabili indipendenti può essere descritto da un’equazione lineare:</p>
<div class="math notranslate nohighlight">
\[E(Y) = \beta_0 + \beta_1X_1 + \beta_2X_2 + \ldots + \beta_pX_p.\]</div>
<p>In questa equazione, i coefficienti <span class="math notranslate nohighlight">\(\beta_0, \beta_1, \beta_2, \ldots, \beta_p\)</span> rappresentano i coefficienti parziali di regressione. Ogni <span class="math notranslate nohighlight">\(\beta_i\)</span> riflette la relazione tra la variabile dipendente <span class="math notranslate nohighlight">\(Y\)</span> e la variabile indipendente corrispondente <span class="math notranslate nohighlight">\(X_i\)</span>, considerando anche l’effetto delle altre variabili presenti nel modello.</p>
<p>Una differenza chiave rispetto al modello di regressione bivariato è nell’interpretazione dei coefficienti. Nel caso bivariato, il coefficiente <span class="math notranslate nohighlight">\(\beta_1\)</span> viene interpretato come il cambiamento atteso in <span class="math notranslate nohighlight">\(Y\)</span> al variare di una unità in <span class="math notranslate nohighlight">\(X_1\)</span>. Tuttavia, nel modello di regressione multipla, l’interpretazione di <span class="math notranslate nohighlight">\(\beta_1\)</span> cambia. In questo caso, <span class="math notranslate nohighlight">\(\beta_1\)</span> rappresenta il cambiamento atteso in <span class="math notranslate nohighlight">\(Y\)</span> al variare di una unità in <span class="math notranslate nohighlight">\(X_1\)</span>, mantenendo costanti gli effetti di tutte le altre variabili <span class="math notranslate nohighlight">\(X_2, X_3, \ldots, X_p\)</span>. In altre parole, <span class="math notranslate nohighlight">\(\beta_1\)</span> ci dice come varia in media <span class="math notranslate nohighlight">\(Y\)</span> quando <span class="math notranslate nohighlight">\(X_1\)</span> cambia, ma considera che altre variabili possono variare insieme a <span class="math notranslate nohighlight">\(X_1\)</span>, e <span class="math notranslate nohighlight">\(\beta_1\)</span> tiene conto di queste variazioni.</p>
<p>Cosa significa mantenere costante l’effetto di altre variabili? Consideriamo l’esempio della correlazione tra il numero di scarpe e le abilità matematiche. Esiste una marcata correlazione positiva tra queste due variabili. Tuttavia, è evidente che i bambini, avendo in genere numeri di scarpe più piccoli rispetto agli adulti, mostrano anche, presumibilmente, minori capacità matematiche. Questo esempio illustra che, se controlliamo per l’età, ossia se consideriamo solo soggetti della stessa età, la correlazione tra il numero di scarpe e le abilità matematiche scompare. Pertanto, nell’analisi della relazione tra abilità matematiche (Y) e numero di scarpe (X), l’età (Z) agisce come variabile confondente. Controllare per Z significa esaminare la relazione tra Y e X limitandosi a individui della stessa età.</p>
<p>Ma ovviamente questo controllo empirico non è sempre possibile. Nel modello di regressione, esso viene «approssimato» con una procedura statistica.</p>
<p><strong>Esempio.</strong> In questo esempio illustreremo la procedura statistica utilizzata per isolare l’effetto di una variabile controllando per un’altra.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creiamo dei dati di esempio</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">X1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">Y</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">X1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">X2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="c1"># Modello completo Y ~ X1 + X2</span>
<span class="n">model_full</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">X1</span><span class="p">,</span> <span class="n">X2</span><span class="p">))))</span>
<span class="n">results_full</span> <span class="o">=</span> <span class="n">model_full</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Regressione di Y su X2</span>
<span class="n">model_Y_on_X2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X2</span><span class="p">))</span>
<span class="n">residuals_Y</span> <span class="o">=</span> <span class="n">model_Y_on_X2</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">resid</span>

<span class="c1"># Regressione di X1 su X2</span>
<span class="n">model_X1_on_X2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X2</span><span class="p">))</span>
<span class="n">residuals_X1</span> <span class="o">=</span> <span class="n">model_X1_on_X2</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span><span class="o">.</span><span class="n">resid</span>

<span class="c1"># Regressione dei residui di Y sui residui di X1</span>
<span class="n">model_residuals</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">residuals_Y</span><span class="p">,</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">residuals_X1</span><span class="p">))</span>
<span class="n">results_residuals</span> <span class="o">=</span> <span class="n">model_residuals</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Stampiamo i risultati</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coefficient from full model for X1: </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results_full</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Coefficient from regression of residuals: </span><span class="si">{:.4f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">results_residuals</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Coefficient from full model for X1: 1.9782
Coefficient from regression of residuals: 1.9782
</pre></div>
</div>
</div>
</div>
<p>Il concetto di <em>coefficiente parziale di regressione</em> viene illustrato in questo esempio. Questo coefficiente quantifica l’effetto della variabile esplicativa <span class="math notranslate nohighlight">\(X_j\)</span> sulla variabile dipendente <span class="math notranslate nohighlight">\(Y\)</span>, depurando l’effetto di <span class="math notranslate nohighlight">\(X_j\)</span> dall’influenza degli altri predittori nel modello. In sostanza, il coefficiente parziale di regressione valuta l’impiego di <span class="math notranslate nohighlight">\(X_j\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> quando <span class="math notranslate nohighlight">\(X_j\)</span> è considerata <em>linearmente indipendente</em> rispetto agli altri predittori <span class="math notranslate nohighlight">\(X\)</span>. L’effetto misurato è quindi quello della sola componente di <span class="math notranslate nohighlight">\(X_j\)</span> che non è spiegata linearmente dai restanti predittori <span class="math notranslate nohighlight">\(X\)</span> sulla parte di <span class="math notranslate nohighlight">\(Y\)</span> che è anch’essa indipendente dai medesimi predittori.</p>
<p>Per chiarire ulteriormente, questo approccio statistico si focalizza sull’analizzare l’effetto di <span class="math notranslate nohighlight">\(X_j\)</span> eliminando l’influenza lineare degli altri predittori <span class="math notranslate nohighlight">\(X\)</span>. È simile a valutare la relazione tra <span class="math notranslate nohighlight">\(Y\)</span> e <span class="math notranslate nohighlight">\(X_j\)</span> in un contesto ideale dove tutti gli individui presentano livelli identici per le altre variabili <span class="math notranslate nohighlight">\(X\)</span>. Tale metodo non eguaglia gli effetti non lineari che possono essere presenti tra le variabili, limitandosi a correggere solo per le associazioni lineari. In questo modo, il controllo statistico tenta di approssimare una condizione di omogeneità tra i soggetti rispetto alle altre variabili <span class="math notranslate nohighlight">\(X\)</span>, consentendo di isolare e valutare più precisamente l’effetto puro di <span class="math notranslate nohighlight">\(X_j\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<section id="scopi-della-regressione">
<h3>Scopi della regressione<a class="headerlink" href="#scopi-della-regressione" title="Link to this heading">#</a></h3>
<p>L’utilizzo del modello di regressione multipla ha principalmente due scopi. In primo luogo, è utilizzato per la predizione, cioè per ottenere la migliore stima possibile di <span class="math notranslate nohighlight">\(Y\)</span> utilizzando una combinazione lineare delle variabili <span class="math notranslate nohighlight">\(X_1, X_2, \ldots, X_p\)</span>. In questo contesto, i coefficienti <span class="math notranslate nohighlight">\(\beta_i\)</span> sono considerati come pesi che permettono di effettuare questa previsione.</p>
<p>In secondo luogo, il modello di regressione multipla viene spesso utilizzato per descrivere le relazioni causali tra le variabili. Tuttavia, è importante sottolineare che questo modello non è stato originariamente creato per stabilire relazioni causali, ed è necessario essere cauti nell’attribuire interpretazioni causali dirette ai coefficienti <span class="math notranslate nohighlight">\(\beta_i\)</span>. Questo perché il modello stima correttamente i coefficienti parziali di regressione solo quando tutte le variabili che influenzano <span class="math notranslate nohighlight">\(Y\)</span> sono incluse nel modello. Nella pratica, spesso non conosciamo tutte le variabili causalmente rilevanti, il che può portare a problemi di errore di specificazione.</p>
<p>In conclusione, il modello di regressione multipla rappresenta uno strumento potente per predire e analizzare le relazioni tra variabili. Tuttavia, è fondamentale riconoscerne le limitazioni, specialmente quando si tentano interpretazioni causali. In ambiti come la psicologia, dove è cruciale comprendere le dinamiche causali, diventa essenziale una scelta accurata delle variabili da includere nel modello per prevenire distorsioni nelle stime dei coefficienti di regressione.</p>
<p>Tradizionalmente, si riteneva vantaggioso includere nel modello il maggior numero possibile di variabili per ottenere un livello di «controllo» statistico più elevato. Tuttavia, come sottolineato da <span id="id1">McElreath [<a class="reference internal" href="../references/bibliography.html#id11" title="Richard McElreath. Statistical rethinking: A Bayesian course with examples in R and Stan. CRC Press, Boca Raton, Florida, 2nd edition edition, 2020.">McE20</a>]</span>, questo metodo può trasformarsi in una «insalata causale». Questo termine descrive una situazione in cui la mancanza di attenzione alla struttura causale tra le variabili può portare all’inclusione di variabili di controllo inappropriate, causando distorsioni nelle stime.</p>
<p>In alcuni casi, l’inserimento di determinate variabili di controllo nel modello è indispensabile per evitare distorsioni, mentre in altri casi, l’inclusione di variabili non pertinenti può portare a risultati fuorvianti. Questo enfatizza l’importanza di formulare ipotesi chiare e ben ponderate sulla struttura causale che intercorre tra le variabili in esame.</p>
<p>L’efficacia e la validità dei risultati ottenuti tramite regressione dipendono strettamente dalla correttezza delle ipotesi causali formulate, sia esplicitamente che implicitamente, dal ricercatore. Pertanto, per superare i limiti dell’approccio dell“«insalata causale», è cruciale che la formulazione del modello di regressione rifletta attentamente tali ipotesi causali.</p>
</section>
</section>
<section id="modello-di-regressione-e-analisi-causale">
<h2>Modello di Regressione e Analisi Causale<a class="headerlink" href="#modello-di-regressione-e-analisi-causale" title="Link to this heading">#</a></h2>
<p>Nel prosieguo di questo capitolo, approfondiremo l’analisi del modello di regressione e l’analisi causale per esaminare come l’inclusione di covariate in un modello multivariato possa influenzare la nostra interpretazione degli effetti causali. Un aspetto cruciale che esploreremo è se l’aggiustamento per una covariata, che indicheremo con <span class="math notranslate nohighlight">\(C\)</span>, possa effettivamente rivelare l’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>Per approfondire questo concetto, analizzeremo come la variabile dipendente <span class="math notranslate nohighlight">\(Y\)</span> risponde a variazioni della variabile indipendente <span class="math notranslate nohighlight">\(X\)</span>, tenendo conto della struttura causale assunta nella generazione dei dati. La discussione si basa su un articolo di <span id="id2">Lübke <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id21" title="Karsten Lübke, Matthias Gehrke, Jörg Horst, and Gero Szepannek. Why we should teach causal inference: examples in linear regression with simulated data. Journal of Statistics Education, 28(2):133–139, 2020.">LubkeGHS20</a>]</span>.</p>
<p>In questo capitolo, distingueremo due tipi di strutture causali. La prima è una struttura a catena, descritta come <span class="math notranslate nohighlight">\(X \rightarrow C \rightarrow Y\)</span>, dove <span class="math notranslate nohighlight">\(X\)</span> influisce su <span class="math notranslate nohighlight">\(C\)</span> che, a sua volta, influisce su <span class="math notranslate nohighlight">\(Y\)</span>. In questo scenario, sarebbe inappropriato condizionare su <span class="math notranslate nohighlight">\(C\)</span>, poiché <span class="math notranslate nohighlight">\(C\)</span> agisce da mediatore nell’effetto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> e condizionare su <span class="math notranslate nohighlight">\(C\)</span> eliminerebbe una parte dell’effetto causale che vogliamo misurare.</p>
<p>Il secondo scenario presenta una struttura a forcella: <span class="math notranslate nohighlight">\(X \leftarrow C \rightarrow Y\)</span>. Qui, <span class="math notranslate nohighlight">\(C\)</span> è la causa comune di <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span>. In questo contesto, è fondamentale aggiustare per <span class="math notranslate nohighlight">\(C\)</span> per eliminare l’effetto confondente e isolare l’effetto diretto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>Il principio guida di questa analisi è di bloccare i percorsi non causali attraverso la distribuzione condizionata e di aprire i percorsi causali mediante la distribuzione marginale. Questo ci orienta nella scelta delle covariate da includere o escludere dal modello di regressione per ottenere stime più precise dell’effetto causale.</p>
<p>Per illustrare meglio questi concetti, ricorreremo a esempi simulati che dimostrano chiaramente quando è necessario l’aggiustamento per certe covariate per scoprire l’effetto causale reale e quando questo potrebbe introdurre distorsioni nella nostra comprensione della relazione causale. Questa tematica è di particolare importanza nel campo della psicologia, dove comprendere le relazioni causali tra variabili è essenziale per lo sviluppo di teorie robuste e la realizzazione di ricerche empiriche affidabili.</p>
<section id="esempio-1-catena">
<h3>Esempio 1: Catena<a class="headerlink" href="#esempio-1-catena" title="Link to this heading">#</a></h3>
<p>Un esempio discusso da <span id="id3">Lübke <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id21" title="Karsten Lübke, Matthias Gehrke, Jörg Horst, and Gero Szepannek. Why we should teach causal inference: examples in linear regression with simulated data. Journal of Statistics Education, 28(2):133–139, 2020.">LubkeGHS20</a>]</span> riguarda le seguenti variabilili: apprendimento, conoscenza e comprensione. Possiamo ipotizzare una struttura causale nella quale l’apprendimento (<span class="math notranslate nohighlight">\(X\)</span>) ha un effetto causale sull’acquisizione di conoscenza (<span class="math notranslate nohighlight">\(C\)</span>). Successivamente, la conoscenza a sua volta incide sulla comprensione (<span class="math notranslate nohighlight">\(Y\)</span>). È importante notare che la comprensione («understanding») è influenzata anche da fattori esterni (<span class="math notranslate nohighlight">\(U\)</span>), che in modelli di regressione vengono rappresentati tramite il termine di errore.</p>
<p>In situazioni reali, per misurare apprendimento, conoscenza e comprensione, è possibile utilizzare strumenti come questionari o misurazioni specifiche. Questi strumenti consentono di quantificare tali variabili per poterle poi analizzarle in contesti di ricerca.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Digraph</span><span class="p">()</span>

<span class="c1"># Definizione dei nodi e degli archi</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;Learning&quot;</span><span class="p">,</span> <span class="s2">&quot;Knowing&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;Knowing&quot;</span><span class="p">,</span> <span class="s2">&quot;Understanding&quot;</span><span class="p">)</span>

<span class="c1"># Impostazione dell&#39;orientamento orizzontale</span>
<span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rankdir</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>
<span class="n">f</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/ab3e0282f1b48bb9a3e3b33a7c487bdfd266b5f73a68be40cdd4e7050d4099a6.svg"><img alt="../_images/ab3e0282f1b48bb9a3e3b33a7c487bdfd266b5f73a68be40cdd4e7050d4099a6.svg" height="211" src="../_images/ab3e0282f1b48bb9a3e3b33a7c487bdfd266b5f73a68be40cdd4e7050d4099a6.svg" width="611" /></a>
</div>
</div>
<p>Per applicare praticamente i concetti discussi, simuliamo i dati seguendo la struttura causale precedentemente descritta:</p>
<div class="math notranslate nohighlight">
\[
X = UX, \quad UX \sim \mathcal{N}(0,1)
\]</div>
<div class="math notranslate nohighlight">
\[
C = 5 \cdot X + UC, \quad UC \sim \mathcal{N}(0,1)
\]</div>
<div class="math notranslate nohighlight">
\[
Y = 3 \cdot C + UY, \quad UY \sim \mathcal{N}(0,1)
\]</div>
<p>Qui, <span class="math notranslate nohighlight">\(\mathcal{N}(\mu, \sigma)\)</span> rappresenta la distribuzione normale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># sample size</span>

<span class="c1"># Simulating the variables</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Learning</span>
<span class="n">C</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">X</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Knowing</span>
<span class="n">Y</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">C</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Understanding</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Y</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>X</th>
      <th>C</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.306527</td>
      <td>-7.979055</td>
      <td>-24.205176</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.658131</td>
      <td>7.838303</td>
      <td>23.018301</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.118164</td>
      <td>-0.271388</td>
      <td>0.522221</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.680178</td>
      <td>-3.538670</td>
      <td>-10.736052</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.666383</td>
      <td>2.374768</td>
      <td>7.585773</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Analizziamo un modello di regressione che considera solo le variabili <span class="math notranslate nohighlight">\(X\)</span> («learning») e <span class="math notranslate nohighlight">\(Y\)</span> («understanding»). Se non includiamo <span class="math notranslate nohighlight">\(C\)</span> («knowing») come covariata nel modello di regressione, otteniamo una stima dell’effetto di «learning» su «understanding» che è priva di distorsioni sistematiche.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod1</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;Y ~ X&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">results1</span> <span class="o">=</span> <span class="n">mod1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "a24b30f3ffa8460098bb44c5396e99e8"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "6938c3fd997f4fbabfb64bfe0ee16146"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "c9c7a15b097745bc920df3e89f74906b"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "347400e1d86647938412d18d5cd2a7ca"}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results1</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-0.12</td>
      <td>0.10</td>
      <td>-0.30</td>
      <td>0.07</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4112.67</td>
      <td>2992.22</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>X</th>
      <td>14.86</td>
      <td>0.10</td>
      <td>14.69</td>
      <td>15.05</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4188.51</td>
      <td>3138.64</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Y_sigma</th>
      <td>3.09</td>
      <td>0.07</td>
      <td>2.97</td>
      <td>3.22</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4061.62</td>
      <td>2828.06</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Secondo il meccanismo di generazione dei dati che abbiamo utilizzato, la stima corretta dell’effetto causale dovrebbe essere <span class="math notranslate nohighlight">\(5 \times 3 = 15\)</span>, che corrisponde al prodotto dei coefficienti lungo il percorso che collega <span class="math notranslate nohighlight">\(X\)</span> a <span class="math notranslate nohighlight">\(Y\)</span>. Il valore ottenuto dal coefficiente parziale di regressione fornisce una stima statistica corretta di questo valore teorico.</p>
<p>Proseguiamo l’analisi eseguendo una regressione che include anche la variabile <span class="math notranslate nohighlight">\(C\)</span> («knowing»), la quale agisce da mediatore tra «learning» (<span class="math notranslate nohighlight">\(X\)</span>) e «understanding» (<span class="math notranslate nohighlight">\(Y\)</span>) nel modello generativo dei dati. La decisione di includere <span class="math notranslate nohighlight">\(C\)</span> come covariata può derivare dalla convinzione che l’inserimento di un maggior numero di variabili nel modello di regressione possa potenziare il controllo statistico sulla stima degli effetti.</p>
<p>Esaminiamo ora l’efficacia di questo approccio, che è stato definito «dell’insalata causale» da <span id="id4">McElreath [<a class="reference internal" href="../references/bibliography.html#id11" title="Richard McElreath. Statistical rethinking: A Bayesian course with examples in R and Stan. CRC Press, Boca Raton, Florida, 2nd edition edition, 2020.">McE20</a>]</span>, nel contesto attuale. Questa analisi ci permetterà di valutare se l’aggiunta di <span class="math notranslate nohighlight">\(C\)</span> nel modello migliora o compromette la nostra capacità di discernere correttamente l’effetto di «learning» su «understanding».</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod2</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;Y ~ X + C&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results2</span> <span class="o">=</span> <span class="n">mod2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "b30cc46a76dd4dbc8c1b87e182c8cad6"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "457e5107d7804a3f843a3d0e8d2e9136"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "66486da1be424244875ee1c8fc6eaa87"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "5f8f7a5521bb485d8227ae4fe6237b27"}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results2</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C</th>
      <td>3.01</td>
      <td>0.03</td>
      <td>2.94</td>
      <td>3.07</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1572.03</td>
      <td>1751.88</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Intercept</th>
      <td>-0.05</td>
      <td>0.03</td>
      <td>-0.12</td>
      <td>-0.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2722.73</td>
      <td>1772.98</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>X</th>
      <td>-0.09</td>
      <td>0.16</td>
      <td>-0.39</td>
      <td>0.22</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1562.30</td>
      <td>1744.17</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Y_sigma</th>
      <td>0.97</td>
      <td>0.02</td>
      <td>0.93</td>
      <td>1.00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2876.66</td>
      <td>2259.10</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Se includiamo «knowing» come covariata nel modello di regressione, otteniamo una stima distorta dell’effetto di «learning» su «understanding». Questo accade perché, controllando per «knowing», che funge da mediatore, induciamo un bias che riduce artificialmente l’effetto totale di «learning» su «understanding». In conclusione, il condizionamento su un mediatore comporta una distorsione sistematica nei risultati.</p>
</section>
<section id="esempio-2-biforcazione">
<h3>Esempio 2: Biforcazione<a class="headerlink" href="#esempio-2-biforcazione" title="Link to this heading">#</a></h3>
<p>In un secondo scenario, analizziamo il ruolo di tre variabili simulate: intelligenza, tempo di apprendimento e punteggio del test. Il modello causale che guida la generazione dei dati assume che l’intelligenza (<span class="math notranslate nohighlight">\(C\)</span>) eserciti un’influenza positiva sul tempo di apprendimento (<span class="math notranslate nohighlight">\(X\)</span>). Allo stesso tempo, sia l’intelligenza (<span class="math notranslate nohighlight">\(C\)</span>) che il tempo di apprendimento (<span class="math notranslate nohighlight">\(X\)</span>), insieme a fattori esterni non specificati (<span class="math notranslate nohighlight">\(U\)</span>), influenzano il punteggio al test (<span class="math notranslate nohighlight">\(Y\)</span>). Per semplificare l’analisi, non consideriamo altre covariate potenzialmente rilevanti come la motivazione o l’interesse degli studenti, focalizzandoci esclusivamente sul tempo dedicato allo studio (<span class="math notranslate nohighlight">\(X\)</span>).</p>
<p>Le relazioni tra le variabili sono definite dalle seguenti equazioni, dove <span class="math notranslate nohighlight">\(\mathcal{N}(\mu, \sigma)\)</span> rappresenta la distribuzione normale:</p>
<ul class="simple">
<li><p>L’intelligenza (<span class="math notranslate nohighlight">\(C\)</span>) è modellata come:
$<span class="math notranslate nohighlight">\(
C = UC, \quad UC \sim \mathcal{N}(100, 15)
\)</span>$</p></li>
<li><p>Il tempo di apprendimento (<span class="math notranslate nohighlight">\(X\)</span>), influenzato dall’intelligenza, segue l’equazione:
$<span class="math notranslate nohighlight">\(
X = 200 - C + UX, \quad UX \sim \mathcal{N}(0, 1)
\)</span>$</p></li>
<li><p>Il punteggio del test (<span class="math notranslate nohighlight">\(Y\)</span>), risultante da intelligenza e tempo di apprendimento, è descritto da:
$<span class="math notranslate nohighlight">\(
Y = 0.5 \cdot C + 0.1 \cdot X + UY, \quad UY \sim \mathcal{N}(0, 1)
\)</span>$</p></li>
</ul>
<p>Queste equazioni riflettono una struttura causale dove l’intelligenza agisce come causa comune sia per il tempo di apprendimento che per il punteggio del test, illustrando un tipico caso di struttura a forcella nel contesto di un modello causale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Digraph</span><span class="p">()</span>
<span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">subgraph</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;Learning Time&quot;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;Test Score&quot;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;Intelligence&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;Intelligence&quot;</span><span class="p">,</span> <span class="s2">&quot;Learning Time&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;Intelligence&quot;</span><span class="p">,</span> <span class="s2">&quot;Test Score&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;Learning Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Test Score&quot;</span><span class="p">)</span>

<span class="n">f</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/6815886c6d0cfee12a45e5c8cb7e3bd64497333d70572a45e7bd4c7f23ef27fd.svg"><img alt="../_images/6815886c6d0cfee12a45e5c8cb7e3bd64497333d70572a45e7bd4c7f23ef27fd.svg" height="211" src="../_images/6815886c6d0cfee12a45e5c8cb7e3bd64497333d70572a45e7bd4c7f23ef27fd.svg" width="611" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># sample size</span>

<span class="c1"># Simulating the variables</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Intelligence</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">-</span> <span class="n">I</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Learning Time</span>
<span class="n">S</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">I</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>  <span class="c1"># Test Score</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">I</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;T&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>I</th>
      <th>T</th>
      <th>S</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>72.214860</td>
      <td>127.980207</td>
      <td>49.684998</td>
    </tr>
    <tr>
      <th>1</th>
      <td>89.300095</td>
      <td>111.060907</td>
      <td>55.562599</td>
    </tr>
    <tr>
      <th>2</th>
      <td>73.566567</td>
      <td>126.585409</td>
      <td>49.989393</td>
    </tr>
    <tr>
      <th>3</th>
      <td>112.457761</td>
      <td>87.319967</td>
      <td>65.237689</td>
    </tr>
    <tr>
      <th>4</th>
      <td>111.717509</td>
      <td>89.587264</td>
      <td>63.532910</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>I dati analizzati sono stati generati seguendo un modello causale in cui il punteggio al test, <span class="math notranslate nohighlight">\(S\)</span>, aumenta di 0.1 punti per ogni unità di incremento nel tempo di apprendimento, <span class="math notranslate nohighlight">\(T\)</span>. Questo implica che più tempo viene dedicato all’apprendimento, più alto è il punteggio medio ottenuto nel test. Consideriamo ora le conseguenze che derivano dall’escludere l’intelligenza, che influisce sia sul tempo di apprendimento che sul punteggio del test, come predittore nel nostro modello di regressione.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod3</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;S ~ T&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">results3</span> <span class="o">=</span> <span class="n">mod3</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "d61091ed25fb4edc8c0ee32e3d512eb9"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "f118138ae2854404bd26053091610fd2"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "0476fd1e89d648308876fbb7117959f9"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "1908da144a3c4225bc819d1e06f0a962"}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results3</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>99.79</td>
      <td>0.23</td>
      <td>99.36</td>
      <td>100.20</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5847.29</td>
      <td>3497.14</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>S_sigma</th>
      <td>1.10</td>
      <td>0.02</td>
      <td>1.05</td>
      <td>1.14</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2896.74</td>
      <td>2518.59</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>T</th>
      <td>-0.40</td>
      <td>0.00</td>
      <td>-0.40</td>
      <td>-0.39</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5967.59</td>
      <td>3392.98</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>I risultati dell’analisi mostrano che, omettendo l’intelligenza dal modello utilizzato per valutare il punteggio del test, si verifica un errore di stima tale da invertire addirittura la direzione dell’effetto reale di <span class="math notranslate nohighlight">\(X\)</span> (Tempo di Apprendimento) su <span class="math notranslate nohighlight">\(Y\)</span> (Punteggio del Test). Questo errore è un esempio del «paradosso di Simpson» <span id="id5">[<a class="reference internal" href="../references/bibliography.html#id44" title="Edward H Simpson. The interpretation of interaction in contingency tables. Journal of the Royal Statistical Society: Series B (Methodological), 13(2):238–241, 1951.">Sim51</a>]</span>, fenomeno per cui le relazioni apparenti tra variabili possono capovolgersi o alterarsi significativamente quando non si considera una variabile confondente critica, nel nostro caso l’intelligenza.</p>
<p>Se condizioniamo sull’intelligenza, invece, l’effetto di «Learning Time» su «Test Score» viene stimato senza errori sistematici.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod4</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;S ~ T + I&quot;</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
<span class="n">results4</span> <span class="o">=</span> <span class="n">mod4</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "3cefe3297d634b9dbaf85f76c4d89b87"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "c147b32bc2ed4c6cb2d35db4a0b97def"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "4f8ef814317e446c8aa71c909f12bb67"}</script><script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "d1a1b4cf2e71467a99463a1b5ae988f1"}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results4</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>I</th>
      <td>0.47</td>
      <td>0.03</td>
      <td>0.41</td>
      <td>0.53</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>1534.19</td>
      <td>1980.39</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>Intercept</th>
      <td>6.18</td>
      <td>6.21</td>
      <td>-5.73</td>
      <td>17.83</td>
      <td>0.16</td>
      <td>0.11</td>
      <td>1534.07</td>
      <td>1949.88</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>S_sigma</th>
      <td>0.99</td>
      <td>0.02</td>
      <td>0.95</td>
      <td>1.03</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>2696.47</td>
      <td>2317.60</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>T</th>
      <td>0.07</td>
      <td>0.03</td>
      <td>0.01</td>
      <td>0.13</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>1536.11</td>
      <td>2009.25</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Questo esempio sottolinea l’importanza di comprendere accuratamente la struttura causale che sta alla base della generazione dei dati. Senza questa comprensione, diventa difficile determinare se l’effetto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> sia positivo o negativo. Per ottenere stime affidabili delle relazioni causali tra le variabili, è fondamentale integrare la struttura causale del processo di generazione dei dati all’interno del modello di regressione. Questo approccio è essenziale per evitare conclusioni errate e garantire l’accuratezza delle inferenze causali.</p>
</section>
</section>
<section id="riflessioni-sulle-simulazioni-di-lubke2020we">
<h2>Riflessioni sulle Simulazioni di <span id="id6">Lübke <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id21" title="Karsten Lübke, Matthias Gehrke, Jörg Horst, and Gero Szepannek. Why we should teach causal inference: examples in linear regression with simulated data. Journal of Statistics Education, 28(2):133–139, 2020.">LubkeGHS20</a>]</span><a class="headerlink" href="#riflessioni-sulle-simulazioni-di-lubke2020we" title="Link to this heading">#</a></h2>
<p>Le simulazioni discusse nell’articolo di <span id="id7">Lübke <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id21" title="Karsten Lübke, Matthias Gehrke, Jörg Horst, and Gero Szepannek. Why we should teach causal inference: examples in linear regression with simulated data. Journal of Statistics Education, 28(2):133–139, 2020.">LubkeGHS20</a>]</span> mettono in luce questioni metodologiche di rilievo e sollevano critiche fondamentali sull’uso convenzionale dei modelli di regressione. La pratica diffusa di incorporare un elevato numero di variabili nei modelli di regressione senza una selezione rigorosa si è rivelata non solo inappropriata ma anche potenzialmente fuorviante. Questo metodo, spesso adottato nella speranza di perfezionare il modello, ignora l’importanza critica di esaminare le relazioni causali tra le variabili.</p>
<p>In particolare, le simulazioni di <span id="id8">Lübke <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id21" title="Karsten Lübke, Matthias Gehrke, Jörg Horst, and Gero Szepannek. Why we should teach causal inference: examples in linear regression with simulated data. Journal of Statistics Education, 28(2):133–139, 2020.">LubkeGHS20</a>]</span> dimostrano come l’inserimento indiscriminato di covariate possa creare associazioni spurie, compromettendo la validità dei risultati ottenuti. Per sviluppare un modello di regressione che non solo si adatti efficacemente ai dati disponibili ma che anche rappresenti accuratamente la struttura causale sottostante, è essenziale una selezione attenta delle covariate. Questa selezione deve essere informata da una comprensione del processo generativo dei dati. La decisione su quali variabili includere in un modello di regressione, dunque, non deve basarsi esclusivamente su criteri statistici, ma deve essere invece guidata da solide basi teoriche.</p>
</section>
<section id="l-inferenza-causale-va-oltre-la-statistica">
<h2>L’Inferenza Causale Va Oltre la Statistica<a class="headerlink" href="#l-inferenza-causale-va-oltre-la-statistica" title="Link to this heading">#</a></h2>
<p>Le simulazioni presentate da <span id="id9">Lübke <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id21" title="Karsten Lübke, Matthias Gehrke, Jörg Horst, and Gero Szepannek. Why we should teach causal inference: examples in linear regression with simulated data. Journal of Statistics Education, 28(2):133–139, 2020.">LubkeGHS20</a>]</span> dimostrano che l’identificazione delle relazioni causali che regolano i fenomeni non può avvenire attraverso l’uso esclusivo di strumenti statistici, senza una solida conoscenza del contesto specifico. Questa tesi è ulteriormente sottolineata nell’articolo di <span id="id10">D’Agostino McGowan <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id20" title="Lucy D’Agostino McGowan, Travis Gerke, and Malcolm Barrett. Causal inference is not just a statistics problem. Journal of Statistics and Data Science Education, pages 1–6, 2024.">DAgostinoMGB24</a>]</span>, intitolato «Causal Inference Is Not Just a Statistics Problem». Per approfondire questa idea, gli autori introducono un «causal quartet», ispirato al celebre quartetto di Anscombe. Il Quartetto di Anscombe è formato da quattro set di dati che, nonostante abbiano identiche proprietà statistiche quali media, varianza e correlazione, si distinguono nettamente nella rappresentazione grafica. Questo esempio è spesso utilizzato per evidenziare l’importanza dell’analisi visiva dei dati, al pari dell’analisi statistica, nell’interpretazione corretta delle informazioni. Allo stesso modo, il «causal quartet» illustra come l’integrazione tra comprensione causale e analisi statistica sia essenziale per effettuare inferenze valide.</p>
<p>Iniziamo ad esaminare il dataset di Anscombe.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;anscombe&quot;</span><span class="p">)</span>

<span class="c1"># Creare una figura e un array di assi</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Disegnare ogni gruppo in un subplot diverso</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()):</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">dataset</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dataset </span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">14</span><span class="p">])</span>

<span class="c1"># Aggiustare lo spazio tra i grafici</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Mostrare la figura</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/64e0917abec0f6fb1c4d4debfedac4190de52d26117040a1bb26ac58a7296801.png"><img alt="../_images/64e0917abec0f6fb1c4d4debfedac4190de52d26117040a1bb26ac58a7296801.png" src="../_images/64e0917abec0f6fb1c4d4debfedac4190de52d26117040a1bb26ac58a7296801.png" style="width: 790px; height: 788px;" /></a>
</div>
</div>
<p>I quattro dataset di Anscombe sono notevoli perché sono stati progettati per avere la stessa media e varianza nelle variabili <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span>, oltre a mostrare identica correlazione e coefficiente di regressione lineare da <span class="math notranslate nohighlight">\(X\)</span> a <span class="math notranslate nohighlight">\(Y\)</span>. Nonostante queste uniformità statistiche, i dataset differiscono significativamente nelle loro rappresentazioni grafiche. Questa distinzione evidenzia un principio fondamentale: le analisi statistiche possono condurre a conclusioni errate se non vengono integrate con un’attenta visualizzazione e una profonda comprensione del contesto dei dati. Il quartetto di Anscombe illustra quindi la necessità di un approccio olistico nell’analisi dei dati, che abbracci sia le tecniche statistiche sia una sensibilità visiva e contestuale.</p>
<p>Il quartetto di <span id="id11">D’Agostino McGowan <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id20" title="Lucy D’Agostino McGowan, Travis Gerke, and Malcolm Barrett. Causal inference is not just a statistics problem. Journal of Statistics and Data Science Education, pages 1–6, 2024.">DAgostinoMGB24</a>]</span> segue una logica simile, ma esplora le implicazioni di differenti strutture causali che hanno originato i dati. Anche se i quattro dataset del quartetto mostrano statistiche descrittive simili e risultano visualmente analoghi, sono stati generati attraverso processi causali diversi. Questo sottolinea come, nonostante l’uguaglianza apparente in termini di statistiche descrittive e rappresentazioni grafiche, i dataset possono derivare da cause sottostanti molto diverse. In alcuni casi, le correlazioni visive tra le variabili possono rispecchiare veri rapporti causali; in altri, possono invece distorcere o nascondere le dinamiche causali reali.</p>
<p>L’analisi statistica convenzionale e le rappresentazioni grafiche, da sole, non sono sufficienti per individuare i meccanismi causali che governano le relazioni tra le variabili. I sommari statistici e le visualizzazioni non offrono una comprensione approfondita dei processi che generano i dati. Pertanto, <span id="id12">D’Agostino McGowan <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id20" title="Lucy D’Agostino McGowan, Travis Gerke, and Malcolm Barrett. Causal inference is not just a statistics problem. Journal of Statistics and Data Science Education, pages 1–6, 2024.">DAgostinoMGB24</a>]</span> enfatizzano l’importanza di integrare le conoscenze sui meccanismi di generazione dei dati nell’analisi, un passo cruciale per scoprire le autentiche relazioni causali tra le variabili. Queste informazioni non sono deducibili direttamente dai dati osservati.</p>
<p>Il lavoro di <span id="id13">D’Agostino McGowan <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id20" title="Lucy D’Agostino McGowan, Travis Gerke, and Malcolm Barrett. Causal inference is not just a statistics problem. Journal of Statistics and Data Science Education, pages 1–6, 2024.">DAgostinoMGB24</a>]</span> enfatizza che, per identificare correttamente gli effetti causali, è essenziale superare i limiti degli strumenti statistici tradizionali, adottando un’analisi informata sui processi generativi dei dati. Questo approccio richiede una comprensione e applicazione di metodologie che considerino le strutture causali sottostanti, spesso non immediatamente evidenti solo dall’osservazione dei dati. In questo modo, il quartetto di <span id="id14">D’Agostino McGowan <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id20" title="Lucy D’Agostino McGowan, Travis Gerke, and Malcolm Barrett. Causal inference is not just a statistics problem. Journal of Statistics and Data Science Education, pages 1–6, 2024.">DAgostinoMGB24</a>]</span> diventa uno strumento didattico efficace per educare i ricercatori sulla complessità dell’inferenza causale e sull’importanza di un’integrazione tra analisi statistica e conoscenza approfondita del contesto e dei meccanismi alla base della generazione dei dati.</p>
<p>Le caratteristiche dei quatto set di dati sono descritte di seguito.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Termine Tecnico</p></th>
<th class="head"><p>Spiegazione</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>(1) Collider</p></td>
<td><p>La variabile <span class="math notranslate nohighlight">\(X\)</span>, causa <span class="math notranslate nohighlight">\(Z\)</span>, e l’esito, <span class="math notranslate nohighlight">\(Y\)</span>, causa <span class="math notranslate nohighlight">\(Z\)</span>. Aggiustando per <span class="math notranslate nohighlight">\(Z\)</span> quando si stima l’effetto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> si ottiene un risultato distorto. Meccanismo di generazione dei dati: <span class="math notranslate nohighlight">\(X \sim \mathcal{N}(0,1)\)</span>, <span class="math notranslate nohighlight">\(Y = X + \varepsilon_y\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_y \sim \mathcal{N}(0,1)\)</span>; <span class="math notranslate nohighlight">\(Z = 0.45X + 0.77Y + \varepsilon_z\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_z \sim \mathcal{N}(0,1)\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>(2) Confounder</p></td>
<td><p>La variabile <span class="math notranslate nohighlight">\(Z\)</span> causa sia la variabile indipendente <span class="math notranslate nohighlight">\(X\)</span>, sia l’esito, <span class="math notranslate nohighlight">\(Y\)</span>. Non aggiustando per <span class="math notranslate nohighlight">\(Z\)</span> quando si stima l’effetto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> si ottiene un risultato distorto. Meccanismo di generazione dei dati: <span class="math notranslate nohighlight">\(Z \sim \mathcal{N}(0,1)\)</span>, <span class="math notranslate nohighlight">\(X = Z + \varepsilon_x\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_x \sim \mathcal{N}(0,1)\)</span>; <span class="math notranslate nohighlight">\(Y = 0.5X + Z + \varepsilon_y\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_y \sim \mathcal{N}(0,1)\)</span></p></td>
</tr>
<tr class="row-even"><td><p>(3) Mediator</p></td>
<td><p>La variabile <span class="math notranslate nohighlight">\(X\)</span> causa <span class="math notranslate nohighlight">\(Z\)</span> che a sua volta causa l’esito <span class="math notranslate nohighlight">\(Y\)</span>. Aggiustando per <span class="math notranslate nohighlight">\(Z\)</span> quando si stima l’effetto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> si ottiene l’effetto diretto, non aggiustando per <span class="math notranslate nohighlight">\(Z\)</span> si ottiene l’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>. L’effetto diretto rappresenta la relazione tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span> indipendentemente da qualsiasi mediatore, mentre l’effetto totale include sia l’effetto diretto sia qualsiasi effetto indiretto mediato dal mediatore potenziale. Meccanismo di generazione dei dati: <span class="math notranslate nohighlight">\(X \sim \mathcal{N}(0,1)\)</span>, <span class="math notranslate nohighlight">\(Z = X + \varepsilon_z\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_z \sim \mathcal{N}(0,1)\)</span>; <span class="math notranslate nohighlight">\(Y = Z + \varepsilon_y\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_y \sim \mathcal{N}(0,1)\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>(4) M-Bias</p></td>
<td><p>Ci sono due variabili aggiuntive, <span class="math notranslate nohighlight">\(U1\)</span> e <span class="math notranslate nohighlight">\(U2\)</span>. Entrambe causano <span class="math notranslate nohighlight">\(Z\)</span>, <span class="math notranslate nohighlight">\(U1\)</span> causa <span class="math notranslate nohighlight">\(X\)</span>, e <span class="math notranslate nohighlight">\(U2\)</span> causa l’esito <span class="math notranslate nohighlight">\(Y\)</span>. Aggiustando per <span class="math notranslate nohighlight">\(Z\)</span> quando si stima l’effetto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> si ottiene un risultato distorto. Meccanismo di generazione dei dati: <span class="math notranslate nohighlight">\(U1 \sim \mathcal{N}(0,1)\)</span>, <span class="math notranslate nohighlight">\(U2 \sim \mathcal{N}(0,1)\)</span>; <span class="math notranslate nohighlight">\(Z = 8U1 + U2 + \varepsilon_z\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_z \sim \mathcal{N}(0,1)\)</span>; <span class="math notranslate nohighlight">\(X = U1 + \varepsilon_x\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_x \sim \mathcal{N}(0,1)\)</span>; <span class="math notranslate nohighlight">\(Y = X + U2 + \varepsilon_y\)</span>, <span class="math notranslate nohighlight">\(\varepsilon_y \sim \mathcal{N}(0, 1)\)</span></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="il-criterio-del-backdoor">
<h2>Il Criterio del Backdoor<a class="headerlink" href="#il-criterio-del-backdoor" title="Link to this heading">#</a></h2>
<p>Prima di approfondire il Quartetto Causale, è essenziale comprendere un concetto chiave nell’analisi causale: il criterio del backdoor, formulato da Judea Pearl. Questo criterio stabilisce una condizione necessaria per ottenere stime non distorte dell’effetto causale di una variabile su un’altra attraverso la regressione, assicurando così una valutazione imparziale dell’effetto causale reale.</p>
<p>Il criterio del backdoor si applica quando si desidera valutare l’effetto causale di una variabile <span class="math notranslate nohighlight">\(X\)</span> (esposizione) su un’altra variabile <span class="math notranslate nohighlight">\(Y\)</span> (risultato), e esistono variabili confondenti <span class="math notranslate nohighlight">\(Z\)</span> che influenzano sia <span class="math notranslate nohighlight">\(X\)</span> sia <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<div class="admonition-backdoor-criterion admonition">
<p class="admonition-title">Backdoor criterion</p>
<p>Secondo Pearl, un insieme di variabili <span class="math notranslate nohighlight">\( Z \)</span> soddisfa il criterio backdoor rispetto a un effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> se:</p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\( Z \)</span> blocca ogni percorso backdoor da <span class="math notranslate nohighlight">\( X \)</span> a <span class="math notranslate nohighlight">\( Y \)</span> che contiene una freccia in entrata verso <span class="math notranslate nohighlight">\( X \)</span>. Un percorso backdoor è un percorso che inizia con una freccia diretta verso <span class="math notranslate nohighlight">\( X \)</span> (ad esempio, da <span class="math notranslate nohighlight">\( X \)</span> verso <span class="math notranslate nohighlight">\( Z \)</span> e da <span class="math notranslate nohighlight">\( Z \)</span> verso <span class="math notranslate nohighlight">\( Y \)</span>).</p></li>
<li><p><span class="math notranslate nohighlight">\( Z \)</span> non include alcun discendente di <span class="math notranslate nohighlight">\( X \)</span>. I discendenti di <span class="math notranslate nohighlight">\( X \)</span> sono variabili che sono influenzate da <span class="math notranslate nohighlight">\( X \)</span>, direttamente o indirettamente.</p></li>
</ol>
<ul class="simple">
<li><p><strong>Effetto diretto e indiretto</strong>: È corretto controllare per variabili che sono cause comuni sia di <span class="math notranslate nohighlight">\( X \)</span> che di <span class="math notranslate nohighlight">\( Y \)</span> (confounders), poiché questi confounders possono aprire percorsi backdoor che confondono l’effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>.</p></li>
<li><p><strong>Introduzione di percorsi indiretti</strong>: Non si dovrebbero controllare le variabili che sono discendenti di <span class="math notranslate nohighlight">\( X \)</span>, poiché includere tali variabili può aprire nuovi percorsi di confondimento tra <span class="math notranslate nohighlight">\( X \)</span> e <span class="math notranslate nohighlight">\( Y \)</span> (per esempio, attraverso variabili mediatrici). Questo errore è noto come «controllo per un collider» o «effetto collider».</p></li>
</ul>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_dag</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">()</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="p">:</span> <span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()}</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span>
        <span class="n">G</span><span class="p">,</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">with_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">node_size</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>
        <span class="n">node_color</span><span class="o">=</span><span class="s2">&quot;skyblue&quot;</span><span class="p">,</span>
        <span class="n">font_size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
        <span class="n">arrows</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="c1"># Scenario 1: Z soddisfa il criterio del backdoor</span>
<span class="n">edges_scenario1</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scenario 1: Z blocca il percorso backdoor da X a Y&quot;</span><span class="p">)</span>
<span class="n">create_dag</span><span class="p">(</span><span class="n">edges_scenario1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scenario 1: Z blocca il percorso backdoor da X a Y
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/6def7ca088d33b7721e7e5cdb9b6ba055dd9ba7e2780631809d850cf33b17003.png"><img alt="../_images/6def7ca088d33b7721e7e5cdb9b6ba055dd9ba7e2780631809d850cf33b17003.png" src="../_images/6def7ca088d33b7721e7e5cdb9b6ba055dd9ba7e2780631809d850cf33b17003.png" style="width: 740px; height: 499px;" /></a>
</div>
</div>
<p>Nel primo scenario è essenziale controllare la variabile <span class="math notranslate nohighlight">\( Z \)</span> per assicurare una stima accurata e non distorta dell’effetto causale di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>. Questa necessità si basa su due aspetti chiave che rispecchiano il criterio del backdoor:</p>
<ol class="arabic simple">
<li><p><strong>Assenza di discendenza</strong>: <span class="math notranslate nohighlight">\( Z \)</span> non è un discendente di <span class="math notranslate nohighlight">\( X \)</span>, il che implica che <span class="math notranslate nohighlight">\( Z \)</span> non riceve alcun effetto da <span class="math notranslate nohighlight">\( X \)</span>. Questo è cruciale perché, se <span class="math notranslate nohighlight">\( Z \)</span> fosse influenzato da <span class="math notranslate nohighlight">\( X \)</span>, potrebbe generare ulteriori correlazioni indirette che alterano l’apparente effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>.</p></li>
<li><p><strong>Interruzione dei percorsi backdoor</strong>: <span class="math notranslate nohighlight">\( Z \)</span> interrompe l’unico percorso backdoor tra <span class="math notranslate nohighlight">\( X \)</span> e <span class="math notranslate nohighlight">\( Y \)</span> che passa attraverso <span class="math notranslate nohighlight">\( Z \)</span> stesso. Regolando per <span class="math notranslate nohighlight">\( Z \)</span>, si eliminano le influenze indirette di <span class="math notranslate nohighlight">\( Z \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>, isolando così l’effetto diretto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>.</p></li>
</ol>
<p>Quindi, nel primo scenario, il controllo di <span class="math notranslate nohighlight">\( Z \)</span> è fondamentale per aderire correttamente al criterio del backdoor e per ottenere una stima affidabile dell’effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scenario 2: Z non soddisfa il criterio del backdoor</span>
<span class="n">edges_scenario2</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Scenario 2: Z non blocca il percorso backdoor da X a Y perché Z è un discendente di X&quot;</span>
<span class="p">)</span>
<span class="n">create_dag</span><span class="p">(</span><span class="n">edges_scenario2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scenario 2: Z non blocca il percorso backdoor da X a Y perché Z è un discendente di X
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/dd37d82c785d3907ee7c358f661495615b85248c6490fac306d3ed33aae88c8e.png"><img alt="../_images/dd37d82c785d3907ee7c358f661495615b85248c6490fac306d3ed33aae88c8e.png" src="../_images/dd37d82c785d3907ee7c358f661495615b85248c6490fac306d3ed33aae88c8e.png" style="width: 740px; height: 499px;" /></a>
</div>
</div>
<p>Nel secondo scenario, non è opportuno utilizzare <span class="math notranslate nohighlight">\( Z \)</span> per controllare l’effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> poiché <span class="math notranslate nohighlight">\( Z \)</span> è un discendente di <span class="math notranslate nohighlight">\( X \)</span>. Questa configurazione porta a problemi significativi:</p>
<ul class="simple">
<li><p><strong>Presenza di un discendente di <span class="math notranslate nohighlight">\( X \)</span> nel set di controllo</strong>: Dato che <span class="math notranslate nohighlight">\( Z \)</span> riceve un influsso da <span class="math notranslate nohighlight">\( X \)</span>, includere <span class="math notranslate nohighlight">\( Z \)</span> come variabile di controllo potrebbe aprire nuovi percorsi di confondimento tra <span class="math notranslate nohighlight">\( X \)</span> e <span class="math notranslate nohighlight">\( Y \)</span> attraverso variabili collaterali o collider. Questo significa che regolare per <span class="math notranslate nohighlight">\( Z \)</span> potrebbe introdurre un errore (bias) nella stima dell’effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> anziché eliminarlo.</p></li>
</ul>
<p>Pertanto, nel secondo scenario, includere <span class="math notranslate nohighlight">\( Z \)</span> nell’analisi causale non è appropriato e potrebbe addirittura peggiorare la precisione della stima degli effetti causali.</p>
</section>
<section id="il-quartetto-causale">
<h2>Il Quartetto Causale<a class="headerlink" href="#il-quartetto-causale" title="Link to this heading">#</a></h2>
<p>I dati forniti da <span id="id15">D’Agostino McGowan <em>et al.</em> [<a class="reference internal" href="../references/bibliography.html#id20" title="Lucy D’Agostino McGowan, Travis Gerke, and Malcolm Barrett. Causal inference is not just a statistics problem. Journal of Statistics and Data Science Education, pages 1–6, 2024.">DAgostinoMGB24</a>]</span> sono disponibili nel pacchetto R «quartets». È possibile effettuare l’importazione di tali dati nell’ambiente Python attraverso la seguente procedura. Tuttavia, è importante notare che è necessario aver precedentemente installato il modulo «rpy2».</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">rpy2</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rpy2</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">rpy2</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="nb">print</span><span class="p">(</span><span class="n">rpy2</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;rpy2&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rpy2.robjects.packages</span> <span class="kn">import</span> <span class="n">importr</span><span class="p">,</span> <span class="n">data</span>
<span class="kn">from</span> <span class="nn">rpy2.robjects</span> <span class="kn">import</span> <span class="n">pandas2ri</span>

<span class="n">utils</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;utils&#39;</span><span class="p">)</span>

<span class="c1"># Specify your CRAN mirror</span>
<span class="n">cran_mirror</span> <span class="o">=</span> <span class="s1">&#39;https://cloud.r-project.org/&#39;</span>

<span class="c1"># Install the package without being prompted for a mirror choice</span>
<span class="n">utils</span><span class="o">.</span><span class="n">install_packages</span><span class="p">(</span><span class="s1">&#39;quartets&#39;</span><span class="p">,</span> <span class="n">repos</span><span class="o">=</span><span class="n">cran_mirror</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R[write to console]: apertura URL &#39;https://cloud.r-project.org/bin/macosx/big-sur-arm64/contrib/4.4/quartets_0.1.1.tgz&#39;

R[write to console]: Content type &#39;application/x-gzip&#39;
R[write to console]:  length 2253600 bytes (2.1 MB)

R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: =
R[write to console]: 

R[write to console]: downloaded 2.1 MB
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>I pacchetti binari scaricati sono in
	/var/folders/s7/z86r4t9j6yx376cm120nln6w0000gn/T//Rtmpp9fHbk/downloaded_packages
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;rpy2.rinterface_lib.sexp.NULLType object at 0x31822ead0&gt; [0]
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="collider">
<h2>Collider<a class="headerlink" href="#collider" title="Link to this heading">#</a></h2>
<p>Il primo set di dati è denominato «causal_collider» e comprende le variabili «exposure,» «outcome,» e «covariate.» Queste variabili sono state generatе seguendo la struttura causale di un collider, come descritto nel diagramma aciclico diretto (DAG) riportato di seguito.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ensure the conversion methods are set up</span>
<span class="n">pandas2ri</span><span class="o">.</span><span class="n">activate</span><span class="p">()</span>
<span class="n">quartets</span> <span class="o">=</span> <span class="n">importr</span><span class="p">(</span><span class="s1">&#39;quartets&#39;</span><span class="p">)</span>
<span class="n">causal_collider</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="n">quartets</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;causal_collider&#39;</span><span class="p">)[</span><span class="s1">&#39;causal_collider&#39;</span><span class="p">]</span>
<span class="c1"># Convert the R data frame to a Pandas DataFrame</span>
<span class="n">causal_collider_df</span> <span class="o">=</span> <span class="n">pandas2ri</span><span class="o">.</span><span class="n">rpy2py</span><span class="p">(</span><span class="n">causal_collider</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">causal_collider_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   exposure   outcome  covariate
1  0.486219  1.705884   2.240050
2  0.065271  0.669207   0.924204
3 -1.402070 -1.596622  -0.999364
4 -0.546029 -1.733149  -2.343315
5 -0.401101  0.616867   0.207155
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Digraph</span><span class="p">()</span>
<span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">subgraph</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;exposure&quot;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;outcome&quot;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;covariate&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="s2">&quot;covariate&quot;</span><span class="p">,</span> <span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;outcome&quot;</span><span class="p">,</span> <span class="s2">&quot;covariate&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="s2">&quot;outcome&quot;</span><span class="p">)</span>

<span class="n">f</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/9208b5d390426084445c87712fd7cc8149dc86d4ba0113d5a234f5a3ef7391c2.svg"><img alt="../_images/9208b5d390426084445c87712fd7cc8149dc86d4ba0113d5a234f5a3ef7391c2.svg" height="499" src="../_images/9208b5d390426084445c87712fd7cc8149dc86d4ba0113d5a234f5a3ef7391c2.svg" width="740" /></a>
</div>
</div>
<p>Se esaminiamo la relazione tra <code class="docutils literal notranslate"><span class="pre">exposure</span></code> e <code class="docutils literal notranslate"><span class="pre">outcome</span></code> notiamo una associazione positiva tra queste due variabili. Il coefficiente di regressione bivariato è 1 e corrisponde al vero effetto causale tra le due variabili. I dati, infatti, sono stati generati nel modo seguente: <span class="math notranslate nohighlight">\(Y = X + \varepsilon_y\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">causal_collider_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;outcome&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/ac278b4fd30fc638f490959b8468596c5e608225fa15d8f1f9cfcacc035b6792.png"><img alt="../_images/ac278b4fd30fc638f490959b8468596c5e608225fa15d8f1f9cfcacc035b6792.png" src="../_images/ac278b4fd30fc638f490959b8468596c5e608225fa15d8f1f9cfcacc035b6792.png" style="width: 731px; height: 491px;" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the Pearson correlation between &#39;exposure&#39; and &#39;outcome&#39;</span>
<span class="n">correlation</span> <span class="o">=</span> <span class="n">causal_collider_df</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">causal_collider_df</span><span class="p">[</span><span class="s1">&#39;outcome&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correlation between &#39;exposure&#39; and &#39;outcome&#39;:&quot;</span><span class="p">,</span> <span class="n">correlation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation between &#39;exposure&#39; and &#39;outcome&#39;: 0.7686468291983661
</pre></div>
</div>
</div>
</div>
<p>La struttura causale descritta, dove <span class="math notranslate nohighlight">\(X \rightarrow Y\)</span>, <span class="math notranslate nohighlight">\(X \rightarrow Z\)</span> e <span class="math notranslate nohighlight">\(Y \rightarrow Z\)</span>, rappresenta un tipico scenario di collider con <span class="math notranslate nohighlight">\(Z\)</span> come variabile collider. In questo scenario, <span class="math notranslate nohighlight">\(Z\)</span> è influenzato sia da <span class="math notranslate nohighlight">\(X\)</span> che da <span class="math notranslate nohighlight">\(Y\)</span>. La questione centrale qui è capire come la scelta delle variabili nel modello di regressione influenzi la stima dell’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<section id="modello-di-regressione-y-x">
<h3>Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code><a class="headerlink" href="#modello-di-regressione-y-x" title="Link to this heading">#</a></h3>
<p>Nel modello di regressione <span class="math notranslate nohighlight">\(Y \sim X\)</span>, stiamo stimando l’effetto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> senza includere il collider <span class="math notranslate nohighlight">\(Z\)</span> nel modello. Secondo il criterio del backdoor di Pearl, per ottenere una stima non distorta dell’effetto causale, dobbiamo chiudere i percorsi backdoor tra le variabili di causa (<span class="math notranslate nohighlight">\(X\)</span>) e effetto (<span class="math notranslate nohighlight">\(Y\)</span>) e non dobbiamo aprire nuovi percorsi che potrebbero introdurre delle correlazioni spurie.</p>
<p>Nella struttura data:</p>
<ul class="simple">
<li><p>Non ci sono variabili confondenti non controllate tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span> che richiedano aggiustamenti per soddisfare il criterio del backdoor.</p></li>
<li><p>Includere <span class="math notranslate nohighlight">\(X\)</span> come predittore di <span class="math notranslate nohighlight">\(Y\)</span> in un modello di regressione chiude l’unico percorso diretto da <span class="math notranslate nohighlight">\(X\)</span> a <span class="math notranslate nohighlight">\(Y\)</span>, senza la necessità di controllare altre variabili per ottenere una stima non distorta dell’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p></li>
</ul>
</section>
<section id="modello-di-regressione-y-x-z">
<h3>Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code><a class="headerlink" href="#modello-di-regressione-y-x-z" title="Link to this heading">#</a></h3>
<p>Nel modello di regressione <span class="math notranslate nohighlight">\(Y \sim X + Z\)</span>, includiamo il collider <span class="math notranslate nohighlight">\(Z\)</span> come variabile nel modello insieme a <span class="math notranslate nohighlight">\(X\)</span>. Questo approccio introduce un problema: quando condizioniamo su un collider (cioè, includiamo il collider come variabile nel modello di regressione), apriamo un percorso non causale tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span> che era precedentemente chiuso. Questo può introdurre una correlazione spuria tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span> attraverso <span class="math notranslate nohighlight">\(Z\)</span>, portando a una stima distorta dell’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>In termini del criterio del backdoor, condizionando su <span class="math notranslate nohighlight">\(Z\)</span>, si viola la condizione per una stima imparziale perché:</p>
<ol class="arabic simple">
<li><p>Si apre un percorso attraverso <span class="math notranslate nohighlight">\(Z\)</span> (il collider), che non era un problema prima di condizionare su di esso.</p></li>
<li><p>Questo percorso aperto introduce una correlazione tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span> che non riflette l’effetto causale diretto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, ma piuttosto l’effetto indiretto mediato da <span class="math notranslate nohighlight">\(Z\)</span>, che in questo caso non è desiderato per la stima dell’effetto causale diretto.</p></li>
</ol>
<p>Eseguiamo l’analisi di regressione <code class="docutils literal notranslate"><span class="pre">outcome</span> <span class="pre">~</span> <span class="pre">exposure</span></code> per i dati nel set <code class="docutils literal notranslate"><span class="pre">causal_collider</span></code>. Poiché i dati nel set <code class="docutils literal notranslate"><span class="pre">causal_collider</span></code> sono generati in conformità con la struttura causale del collider,questa regressione produrrà una stima non distorta dell’effetto causale reale tra le due variabili.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod8</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;outcome ~ exposure&quot;</span><span class="p">,</span> <span class="n">causal_collider_df</span><span class="p">)</span>
<span class="n">results8</span> <span class="o">=</span> <span class="n">mod8</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c7c1ec23d7634773b11f3099f106c747", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "0b96b55faa3749639d6f1faf9093ee04", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "83cc7a00a12b4309b4a854be17ff35db", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "6597035ba49c4d97b49a9698b41c6405", "version_major": 2, "version_minor": 0}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results8</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>0.13</td>
      <td>0.09</td>
      <td>-0.04</td>
      <td>0.31</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3121.91</td>
      <td>2335.68</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>exposure</th>
      <td>1.00</td>
      <td>0.09</td>
      <td>0.84</td>
      <td>1.17</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3806.73</td>
      <td>2550.29</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>outcome_sigma</th>
      <td>0.89</td>
      <td>0.06</td>
      <td>0.76</td>
      <td>1.01</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3824.03</td>
      <td>2931.08</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Se invece aggiungiamo <code class="docutils literal notranslate"><span class="pre">covariate</span></code> nel modello di regressione come predittore di <code class="docutils literal notranslate"><span class="pre">outcome</span></code> otteniamo invece una stima distorta dell’effetto causale di <code class="docutils literal notranslate"><span class="pre">exposure</span></code> su <code class="docutils literal notranslate"><span class="pre">outcome</span></code>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod8_bis</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;outcome ~ exposure + covariate&quot;</span><span class="p">,</span> <span class="n">causal_collider_df</span><span class="p">)</span>
<span class="n">results8_bis</span> <span class="o">=</span> <span class="n">mod8_bis</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c3e8c84485714e2c8ac81e77c8e2548c", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "0dd8f90fb3b240829929eac409b50839", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "e0c938e2c9314ddd944875c4dd4ef445", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "f9c81dd139914db8906b887e0bc349a2", "version_major": 2, "version_minor": 0}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results8_bis</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>0.12</td>
      <td>0.08</td>
      <td>-0.03</td>
      <td>0.26</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3851.63</td>
      <td>2992.44</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>covariate</th>
      <td>0.39</td>
      <td>0.06</td>
      <td>0.27</td>
      <td>0.49</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3185.71</td>
      <td>2852.59</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>exposure</th>
      <td>0.55</td>
      <td>0.10</td>
      <td>0.37</td>
      <td>0.74</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3310.22</td>
      <td>2937.69</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>outcome_sigma</th>
      <td>0.75</td>
      <td>0.05</td>
      <td>0.65</td>
      <td>0.85</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3957.42</td>
      <td>3313.77</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In sintesi, la corretta applicazione del criterio del backdoor in questa struttura causale suggerisce che per stimare l’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, dovremmo utilizzare il modello di regressione <span class="math notranslate nohighlight">\(Y \sim X\)</span>, e non <span class="math notranslate nohighlight">\(Y \sim X + Z\)</span>. Includere <span class="math notranslate nohighlight">\(Z\)</span> nel modello introduce un bias nella stima dell’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> a causa dell’apertura di un percorso attraverso il collider <span class="math notranslate nohighlight">\(Z\)</span>, che non rappresenta l’effetto causale diretto che vogliamo stimare.</p>
</section>
</section>
<section id="confounder">
<h2>Confounder<a class="headerlink" href="#confounder" title="Link to this heading">#</a></h2>
<p>Il secondo data set è chiamato <code class="docutils literal notranslate"><span class="pre">causal_confounding</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">causal_confounding</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="n">quartets</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;causal_confounding&#39;</span><span class="p">)[</span><span class="s1">&#39;causal_confounding&#39;</span><span class="p">]</span>
<span class="c1"># Convert the R data frame to a Pandas DataFrame</span>
<span class="n">causal_confounding_df</span> <span class="o">=</span> <span class="n">pandas2ri</span><span class="o">.</span><span class="n">rpy2py</span><span class="p">(</span><span class="n">causal_confounding</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">causal_confounding_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   covariate  exposure   outcome
1  -0.622268  0.033178 -0.429296
2   1.136951  0.362695  2.674816
3  -0.237867  0.242180 -0.647128
4   1.529001  1.463265  2.238149
5  -0.154499  0.779136  1.044306
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Digraph</span><span class="p">()</span>
<span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">subgraph</span><span class="p">()</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
    <span class="n">s</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;exposure&quot;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;outcome&quot;</span><span class="p">)</span>

<span class="n">f</span><span class="o">.</span><span class="n">node</span><span class="p">(</span><span class="s2">&quot;covariate&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;covariate&quot;</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;covariate&quot;</span><span class="p">,</span> <span class="s2">&quot;outcome&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="s2">&quot;outcome&quot;</span><span class="p">)</span>

<span class="n">f</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/ad0b336ddb5e952d70eac49118996a330ccbbf733c0332d8e4b89e94dcca5234.svg"><img alt="../_images/ad0b336ddb5e952d70eac49118996a330ccbbf733c0332d8e4b89e94dcca5234.svg" height="491" src="../_images/ad0b336ddb5e952d70eac49118996a330ccbbf733c0332d8e4b89e94dcca5234.svg" width="731" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">causal_confounding_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;outcome&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/e95335df66dbf4d0b11a29af868f0ad51a4647ed7c85f15d644a08265d58375f.png"><img alt="../_images/e95335df66dbf4d0b11a29af868f0ad51a4647ed7c85f15d644a08265d58375f.png" src="../_images/e95335df66dbf4d0b11a29af868f0ad51a4647ed7c85f15d644a08265d58375f.png" style="width: 731px; height: 491px;" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the Pearson correlation between &#39;exposure&#39; and &#39;outcome&#39;</span>
<span class="n">correlation</span> <span class="o">=</span> <span class="n">causal_confounding_df</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">causal_confounding_df</span><span class="p">[</span><span class="s1">&#39;outcome&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correlation between &#39;exposure&#39; and &#39;outcome&#39;:&quot;</span><span class="p">,</span> <span class="n">correlation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation between &#39;exposure&#39; and &#39;outcome&#39;: 0.7354068318349994
</pre></div>
</div>
</div>
</div>
<p>Quando i dati sono generati con una struttura di confounder, in cui <span class="math notranslate nohighlight">\(Z \rightarrow X\)</span> e <span class="math notranslate nohighlight">\(Z \rightarrow Y\)</span>, oltre al percorso diretto <span class="math notranslate nohighlight">\(X \rightarrow Y\)</span>, ci troviamo in una configurazione classica in cui <span class="math notranslate nohighlight">\(Z\)</span> funge da variabile confondente. Questo scenario è significativamente diverso dal caso del collider discusso precedentemente. Qui, <span class="math notranslate nohighlight">\(Z\)</span> influisce sia sulla variabile indipendente (<span class="math notranslate nohighlight">\(X\)</span>) che sulla variabile dipendente (<span class="math notranslate nohighlight">\(Y\)</span>), creando un percorso backdoor che deve essere bloccato per ottenere una stima non distorta dell’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<section id="id16">
<h3>Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code><a class="headerlink" href="#id16" title="Link to this heading">#</a></h3>
<p>Secondo il criterio del backdoor di Pearl, per ottenere una stima imparziale dell’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, dobbiamo controllare per (o aggiustare per) tutte le variabili confondenti che aprono percorsi backdoor tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span>. In questo scenario, <span class="math notranslate nohighlight">\(Z\)</span> è una variabile confondente perché influisce sia su <span class="math notranslate nohighlight">\(X\)</span> che su <span class="math notranslate nohighlight">\(Y\)</span>, aprendo un percorso backdoor tra queste due variabili.</p>
<p>Aggiustare per <span class="math notranslate nohighlight">\(Z\)</span> (cioè, includere <span class="math notranslate nohighlight">\(Z\)</span> nel modello di regressione <span class="math notranslate nohighlight">\(Y \sim X + Z\)</span>) blocca il percorso backdoor da <span class="math notranslate nohighlight">\(X\)</span> a <span class="math notranslate nohighlight">\(Y\)</span> attraverso <span class="math notranslate nohighlight">\(Z\)</span>, permettendoci di isolare l’effetto diretto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>. Facendo ciò, otteniamo una stima non distorta dell’effetto causale perché abbiamo eliminato l’influenza del confondente <span class="math notranslate nohighlight">\(Z\)</span> sull’associazione tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span>.</p>
</section>
<section id="id17">
<h3>Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code><a class="headerlink" href="#id17" title="Link to this heading">#</a></h3>
<p>Se utilizziamo il modello di regressione <span class="math notranslate nohighlight">\(Y \sim X\)</span> senza includere il confondente <span class="math notranslate nohighlight">\(Z\)</span>, non stiamo bloccando il percorso backdoor aperto da <span class="math notranslate nohighlight">\(Z\)</span>. Ciò significa che qualsiasi associazione osservata tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span> potrebbe essere influenzata (confusa) dall’effetto di <span class="math notranslate nohighlight">\(Z\)</span> su entrambe queste variabili, portando a una stima distorta dell’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>. In altre parole, non possiamo essere sicuri che l’associazione osservata tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span> rifletta un effetto causale diretto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, piuttosto che un’associazione indotta dal confondente comune <span class="math notranslate nohighlight">\(Z\)</span>.</p>
<p>Nel modello di regressione, se ignoriamo <code class="docutils literal notranslate"><span class="pre">covariate</span></code>, otteniamo una stima distorta dell’effetto causale di <code class="docutils literal notranslate"><span class="pre">exposure</span></code> su <code class="docutils literal notranslate"><span class="pre">outcome</span></code>. I dati sono stati generati con <span class="math notranslate nohighlight">\(Y = 0.5X + Z + \varepsilon_y\)</span>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod9</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;outcome ~ exposure&quot;</span><span class="p">,</span> <span class="n">causal_confounding_df</span><span class="p">)</span>
<span class="n">results9</span> <span class="o">=</span> <span class="n">mod9</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3eeb28fbb7f54fb29e433538b32323be", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "2feb61625b2d43ad87d0be50809ef683", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "b4ae23278b0749dab22a2629f647112e", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "3079dfb0f5a445d7a004fb900de93ecf", "version_major": 2, "version_minor": 0}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results9</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-0.01</td>
      <td>0.13</td>
      <td>-0.25</td>
      <td>0.22</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3564.56</td>
      <td>2389.82</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>exposure</th>
      <td>1.00</td>
      <td>0.09</td>
      <td>0.84</td>
      <td>1.18</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3592.34</td>
      <td>2663.58</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>outcome_sigma</th>
      <td>1.21</td>
      <td>0.09</td>
      <td>1.06</td>
      <td>1.38</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3694.39</td>
      <td>3032.86</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Se invece condizioniamo su <code class="docutils literal notranslate"><span class="pre">covariate</span></code>, otteniamo una stima non distorta dell’effetto causale di <code class="docutils literal notranslate"><span class="pre">exposure</span></code> su <code class="docutils literal notranslate"><span class="pre">outcome</span></code>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod9_bis</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;outcome ~ exposure + covariate&quot;</span><span class="p">,</span> <span class="n">causal_confounding_df</span><span class="p">)</span>
<span class="n">results9_bis</span> <span class="o">=</span> <span class="n">mod9_bis</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "c4f89def68eb400781a0717792ddbc71", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "4339b9b0263042d782845e2d3f9d2d51", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "7a82f8ddb23a492faaba848e57d12335", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "9daf599255ba49ccb48e41e4de620155", "version_major": 2, "version_minor": 0}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results9_bis</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-0.04</td>
      <td>0.10</td>
      <td>-0.24</td>
      <td>0.16</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3570.53</td>
      <td>2419.72</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>covariate</th>
      <td>0.96</td>
      <td>0.15</td>
      <td>0.69</td>
      <td>1.24</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2787.20</td>
      <td>2554.51</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>exposure</th>
      <td>0.50</td>
      <td>0.11</td>
      <td>0.30</td>
      <td>0.71</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2680.87</td>
      <td>2732.98</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>outcome_sigma</th>
      <td>1.02</td>
      <td>0.07</td>
      <td>0.88</td>
      <td>1.15</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3724.17</td>
      <td>2931.00</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In sintesi, il criterio del backdoor ci dice che, nella presenza di variabili confondenti che aprono percorsi backdoor tra la variabile indipendente e la variabile dipendente, è essenziale controllare per queste variabili nel modello di regressione per ottenere una stima imparziale dell’effetto causale. Nel caso della struttura con <span class="math notranslate nohighlight">\(Z\)</span> come confondente che influisce sia su <span class="math notranslate nohighlight">\(X\)</span> che su <span class="math notranslate nohighlight">\(Y\)</span>, il modello <span class="math notranslate nohighlight">\(Y \sim X + Z\)</span> fornisce una stima corretta dell’effetto causale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> perché blocca il percorso backdoor attraverso <span class="math notranslate nohighlight">\(Z\)</span>, mentre il modello <span class="math notranslate nohighlight">\(Y \sim X\)</span> non lo fa, lasciando la stima dell’effetto causale potenzialmente distorta.</p>
</section>
</section>
<section id="mediazione">
<h2>Mediazione<a class="headerlink" href="#mediazione" title="Link to this heading">#</a></h2>
<p>Il terzo set di dati si chiama <code class="docutils literal notranslate"><span class="pre">causal_mediator</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">causal_mediator</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="n">quartets</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;causal_mediator&#39;</span><span class="p">)[</span><span class="s1">&#39;causal_mediator&#39;</span><span class="p">]</span>
<span class="c1"># Convert the R data frame to a Pandas DataFrame</span>
<span class="n">causal_mediator_df</span> <span class="o">=</span> <span class="n">pandas2ri</span><span class="o">.</span><span class="n">rpy2py</span><span class="p">(</span><span class="n">causal_mediator</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">causal_mediator_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   exposure  covariate   outcome
1  0.067197   0.129825 -0.140413
2  0.087756   0.002409 -0.031944
3 -0.751281   0.383943  0.632418
4  0.076000  -0.376841 -0.910737
5 -1.569622  -1.661511 -2.834616
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Digraph</span><span class="p">()</span>

<span class="c1"># Definizione dei nodi e degli archi</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="s2">&quot;covariate&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;covariate&quot;</span><span class="p">,</span> <span class="s2">&quot;outcome&quot;</span><span class="p">)</span>

<span class="c1"># Impostazione dell&#39;orientamento orizzontale</span>
<span class="n">f</span><span class="o">.</span><span class="n">attr</span><span class="p">(</span><span class="n">rankdir</span><span class="o">=</span><span class="s1">&#39;LR&#39;</span><span class="p">)</span>
<span class="n">f</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/f9e79143c47cae4b1bf0ef5e900c85df53a0c5a3e44ce84ecc2c390bd40ee11f.svg"><img alt="../_images/f9e79143c47cae4b1bf0ef5e900c85df53a0c5a3e44ce84ecc2c390bd40ee11f.svg" height="491" src="../_images/f9e79143c47cae4b1bf0ef5e900c85df53a0c5a3e44ce84ecc2c390bd40ee11f.svg" width="731" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">causal_mediator_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;outcome&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/6b0dba6e6646b9d927b58248801a296c931e137bed8bf8e742dbb25a73eb5f26.png"><img alt="../_images/6b0dba6e6646b9d927b58248801a296c931e137bed8bf8e742dbb25a73eb5f26.png" src="../_images/6b0dba6e6646b9d927b58248801a296c931e137bed8bf8e742dbb25a73eb5f26.png" style="width: 731px; height: 491px;" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the Pearson correlation between &#39;exposure&#39; and &#39;outcome&#39;</span>
<span class="n">correlation</span> <span class="o">=</span> <span class="n">causal_mediator_df</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">causal_mediator_df</span><span class="p">[</span><span class="s1">&#39;outcome&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correlation between &#39;exposure&#39; and &#39;outcome&#39;:&quot;</span><span class="p">,</span> <span class="n">correlation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation between &#39;exposure&#39; and &#39;outcome&#39;: 0.5944519516171226
</pre></div>
</div>
</div>
</div>
<p>Nella struttura di mediazione, <span class="math notranslate nohighlight">\(X \rightarrow Z \rightarrow Y\)</span>, <span class="math notranslate nohighlight">\(Z\)</span> agisce come variabile mediatrice nel percorso causale da <span class="math notranslate nohighlight">\(X\)</span> a <span class="math notranslate nohighlight">\(Y\)</span>. Questo significa che l’effetto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> passa attraverso <span class="math notranslate nohighlight">\(Z\)</span>. L’obiettivo della modellazione causale in questo scenario è spesso di stimare l’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, che include sia l’effetto diretto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> (se presente) sia l’effetto indiretto mediato da <span class="math notranslate nohighlight">\(Z\)</span>.</p>
<section id="id18">
<h3>Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code><a class="headerlink" href="#id18" title="Link to this heading">#</a></h3>
<p>Nel modello di regressione <span class="math notranslate nohighlight">\(Y \sim X\)</span>, stiamo cercando di stimare l’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, senza cercare di decomporre questo effetto in componenti diretti e indiretti. In questa configurazione, non dobbiamo aggiustare per la variabile mediatrice <span class="math notranslate nohighlight">\(Z\)</span> quando il nostro obiettivo è stimare l’effetto totale, perché fare ciò rimuoverebbe l’effetto indiretto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> attraverso <span class="math notranslate nohighlight">\(Z\)</span> dalla nostra stima, lasciandoci solo con l’effetto diretto (se esiste).</p>
<p>Secondo il criterio del backdoor di Pearl, non ci sono percorsi backdoor tra <span class="math notranslate nohighlight">\(X\)</span> e <span class="math notranslate nohighlight">\(Y\)</span> che richiedono di essere bloccati, poiché l’unico percorso da <span class="math notranslate nohighlight">\(X\)</span> a <span class="math notranslate nohighlight">\(Y\)</span> è attraverso <span class="math notranslate nohighlight">\(Z\)</span>, che è il percorso causale di interesse. Pertanto, il modello <span class="math notranslate nohighlight">\(Y \sim X\)</span> non apre nuovi percorsi backdoor e ci fornisce una stima corretta dell’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p>
</section>
<section id="id19">
<h3>Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code><a class="headerlink" href="#id19" title="Link to this heading">#</a></h3>
<p>Nel modello di regressione <span class="math notranslate nohighlight">\(Y \sim X + Z\)</span>, stiamo cercando di controllare per <span class="math notranslate nohighlight">\(Z\)</span> oltre a includere <span class="math notranslate nohighlight">\(X\)</span>. Mentre questo modello può essere utile per esplorare l’effetto diretto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> controllando per l’effetto mediatore di <span class="math notranslate nohighlight">\(Z\)</span>, questo approccio non è appropriato quando l’obiettivo è stimare l’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>. Aggiustando per <span class="math notranslate nohighlight">\(Z\)</span>, rimuoviamo l’effetto della mediazione di <span class="math notranslate nohighlight">\(Z\)</span> dall’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, il che potrebbe portarci a sottostimare l’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> poiché escludiamo l’effetto indiretto attraverso <span class="math notranslate nohighlight">\(Z\)</span>.</p>
<p>Inoltre, secondo il criterio del backdoor, aggiustare per la variabile mediatrice in un percorso causale diretto (come <span class="math notranslate nohighlight">\(X \rightarrow Z \rightarrow Y\)</span>) non è necessario per ottenere una stima imparziale dell’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, e può effettivamente introdurre bias se il nostro obiettivo è di stimare l’effetto totale piuttosto che isolare l’effetto diretto.</p>
<p>Adattando ai dati un modello di regressione bivariato otteniamo una stima non distorta del vero effetto causale di <code class="docutils literal notranslate"><span class="pre">exposure</span></code> su <code class="docutils literal notranslate"><span class="pre">outcome</span></code>. Infatti, i dati sono stati generati con <span class="math notranslate nohighlight">\(Y = Z + \varepsilon_y\)</span>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod10</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;outcome ~ exposure&quot;</span><span class="p">,</span> <span class="n">causal_mediator_df</span><span class="p">)</span>
<span class="n">results10</span> <span class="o">=</span> <span class="n">mod10</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "a83a40e0835b402c90df820c9798d19a", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "a3f46c0d41074cb7aba5dd0ce90a707b", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "acbe38454ed3475db37277ec86378f16", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "26c09948dafb4d34b9b17689e2283cd7", "version_major": 2, "version_minor": 0}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results10</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-0.00</td>
      <td>0.14</td>
      <td>-0.28</td>
      <td>0.25</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3665.35</td>
      <td>2997.87</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>exposure</th>
      <td>0.99</td>
      <td>0.14</td>
      <td>0.72</td>
      <td>1.26</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3726.98</td>
      <td>2621.86</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>outcome_sigma</th>
      <td>1.40</td>
      <td>0.10</td>
      <td>1.22</td>
      <td>1.60</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3703.01</td>
      <td>2950.67</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Se invece condizioniamo sul mediatore (<code class="docutils literal notranslate"><span class="pre">covariate</span></code>) otteniamo una stima distorta dell’effetto causale di <code class="docutils literal notranslate"><span class="pre">exposure</span></code> su <code class="docutils literal notranslate"><span class="pre">outcome</span></code>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod10_bis</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;outcome ~ exposure + covariate&quot;</span><span class="p">,</span> <span class="n">causal_mediator_df</span><span class="p">)</span>
<span class="n">results10_bis</span> <span class="o">=</span> <span class="n">mod10_bis</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "3b15ad7f0a3a40d78082973fc387bf7f", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "6498f88f56404e1ea6ddc6710150e860", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "fee24ed55c7847e7a49592152ff393f1", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "351945e5aabe4d8da233ad63ffb5afd2", "version_major": 2, "version_minor": 0}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results10_bis</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>0.01</td>
      <td>0.09</td>
      <td>-0.15</td>
      <td>0.19</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3719.62</td>
      <td>2670.24</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>covariate</th>
      <td>1.07</td>
      <td>0.09</td>
      <td>0.89</td>
      <td>1.24</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2479.69</td>
      <td>2612.85</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>exposure</th>
      <td>0.00</td>
      <td>0.13</td>
      <td>-0.24</td>
      <td>0.24</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2651.49</td>
      <td>2556.06</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>outcome_sigma</th>
      <td>0.92</td>
      <td>0.07</td>
      <td>0.80</td>
      <td>1.05</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3570.91</td>
      <td>2453.08</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In sintesi, per stimare correttamente l’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span> in una struttura di mediazione, è necessario utilizzare il modello di regressione <span class="math notranslate nohighlight">\(Y \sim X\)</span>, che ci fornisce una stima dell’effetto totale includendo sia gli effetti diretti che quelli indiretti mediati da <span class="math notranslate nohighlight">\(Z\)</span>. Il modello <span class="math notranslate nohighlight">\(Y \sim X + Z\)</span> è appropriato solo se siamo interessati a isolare l’effetto diretto di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>, controllando per l’effetto di <span class="math notranslate nohighlight">\(Z\)</span>, ma non per stimare l’effetto totale di <span class="math notranslate nohighlight">\(X\)</span> su <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<p>Nel modello di mediazione <span class="math notranslate nohighlight">\( X \rightarrow Z \rightarrow Y \)</span>, dove <span class="math notranslate nohighlight">\( X \)</span> è la variabile indipendente, <span class="math notranslate nohighlight">\( Z \)</span> è la variabile mediatrice, e <span class="math notranslate nohighlight">\( Y \)</span> è la variabile dipendente, l’applicazione del criterio backdoor di Judea Pearl può essere illustrata considerando come stimare l’effetto totale di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> e come separare questo effetto in componenti diretto e indiretto.</p>
</section>
<section id="obiettivo-dell-analisi">
<h3>Obiettivo dell’analisi<a class="headerlink" href="#obiettivo-dell-analisi" title="Link to this heading">#</a></h3>
<p>Nel modello di mediazione, l’obiettivo può essere duplice:</p>
<ol class="arabic simple">
<li><p><strong>Stimare l’effetto totale di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span></strong>: Questo include sia l’effetto diretto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> che non passa attraverso <span class="math notranslate nohighlight">\( Z \)</span>, sia l’effetto indiretto che passa attraverso <span class="math notranslate nohighlight">\( Z \)</span>.</p></li>
<li><p><strong>Separare l’effetto totale in effetti diretti e indiretti</strong>: Questo ci aiuta a comprendere quanto dell’effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> è mediato da <span class="math notranslate nohighlight">\( Z \)</span>.</p></li>
</ol>
</section>
<section id="applicazione-del-criterio-backdoor">
<h3>Applicazione del Criterio Backdoor<a class="headerlink" href="#applicazione-del-criterio-backdoor" title="Link to this heading">#</a></h3>
<p>Nel caso specifico del modello di mediazione:</p>
<ul class="simple">
<li><p><strong>Per stimare l’effetto totale di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span></strong>: Non dovresti controllare per <span class="math notranslate nohighlight">\( Z \)</span> quando stai stimando l’effetto totale di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>. In questo caso, il criterio backdoor non richiede di bloccare alcun percorso perché non ci sono variabili confounding non osservate tra <span class="math notranslate nohighlight">\( X \)</span> e <span class="math notranslate nohighlight">\( Y \)</span> che siano correlate sia con <span class="math notranslate nohighlight">\( X \)</span> sia con <span class="math notranslate nohighlight">\( Y \)</span> attraverso percorsi non causali.</p></li>
<li><p><strong>Per stimare l’effetto diretto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span></strong>: Dovresti controllare per <span class="math notranslate nohighlight">\( Z \)</span> per eliminare l’effetto del mediatore e isolare l’effetto diretto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>.</p></li>
</ul>
</section>
<section id="considerazioni-pratiche">
<h3>Considerazioni Pratiche<a class="headerlink" href="#considerazioni-pratiche" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Analisi di mediazione</strong>: Tipicamente si esegue un’analisi di regressione multipla dove si include <span class="math notranslate nohighlight">\( Z \)</span> come predittore insieme a <span class="math notranslate nohighlight">\( X \)</span> per valutare gli effetti diretti e indiretti.</p>
<ul class="simple">
<li><p><strong>Modello 1</strong>: Regressione di <span class="math notranslate nohighlight">\( Z \)</span> su <span class="math notranslate nohighlight">\( X \)</span> per stimare l’effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Z \)</span> (path a).</p></li>
<li><p><strong>Modello 2</strong>: Regressione di <span class="math notranslate nohighlight">\( Y \)</span> su <span class="math notranslate nohighlight">\( X \)</span> e <span class="math notranslate nohighlight">\( Z \)</span> per stimare l’effetto diretto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> controllando per <span class="math notranslate nohighlight">\( Z \)</span> e per valutare l’effetto di <span class="math notranslate nohighlight">\( Z \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> (path b).</p></li>
</ul>
</li>
<li><p><strong>Interpretazione</strong>:</p>
<ul class="simple">
<li><p><strong>Effetto diretto</strong>: L’effetto di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span> che non passa per <span class="math notranslate nohighlight">\( Z \)</span> (coefficiente di <span class="math notranslate nohighlight">\( X \)</span> in Modello 2).</p></li>
<li><p><strong>Effetto indiretto</strong>: Calcolato come il prodotto dei coefficienti dei percorsi da <span class="math notranslate nohighlight">\( X \)</span> a <span class="math notranslate nohighlight">\( Z \)</span> e da <span class="math notranslate nohighlight">\( Z \)</span> a <span class="math notranslate nohighlight">\( Y \)</span> (cioè, il prodotto dei coefficienti di path a e path b).</p></li>
</ul>
</li>
</ol>
<p>In sintesi, nel modello di mediazione <span class="math notranslate nohighlight">\( X \rightarrow Z \rightarrow Y \)</span>, il criterio backdoor ci aiuta a decidere quando includere o escludere il mediatore <span class="math notranslate nohighlight">\( Z \)</span> nelle regressioni per isolare gli effetti diretti e indiretti di <span class="math notranslate nohighlight">\( X \)</span> su <span class="math notranslate nohighlight">\( Y \)</span>. Questa è una componente fondamentale per l’interpretazione corretta dei meccanismi sottostanti alle relazioni causali osservate.</p>
</section>
</section>
<section id="causal-m-bias">
<h2>Causal M-bias<a class="headerlink" href="#causal-m-bias" title="Link to this heading">#</a></h2>
<p>Nell’ultimo set di dati ci sono due fattori aggiuntivi, U1 e U2. Entrambi causano Z, U1 causa <code class="docutils literal notranslate"><span class="pre">exposure</span></code>, X, e U2 causa <code class="docutils literal notranslate"><span class="pre">outcome</span></code>, Y. Effettuare un aggiustamento per Z durante la stima dell’effetto di X su Y produce un risultato distorto.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">causal_m_bias</span> <span class="o">=</span> <span class="n">data</span><span class="p">(</span><span class="n">quartets</span><span class="p">)</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;causal_m_bias&#39;</span><span class="p">)[</span><span class="s1">&#39;causal_m_bias&#39;</span><span class="p">]</span>
<span class="c1"># Convert the R data frame to a Pandas DataFrame</span>
<span class="n">causal_m_bias_df</span> <span class="o">=</span> <span class="n">pandas2ri</span><span class="o">.</span><span class="n">rpy2py</span><span class="p">(</span><span class="n">causal_m_bias</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">causal_m_bias_df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>         u1        u2  covariate  exposure   outcome
1  0.544050 -1.354656   5.236805  2.451155 -0.142505
2  0.085600  0.131291  -0.047646  0.976479  0.711355
3  0.674619 -0.461275   6.377459  0.282988 -0.198427
4  1.896146  0.580910  15.866842  1.961346  4.188398
5  0.350692 -1.709183   0.796247  0.854928 -1.845741
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">graphviz</span><span class="o">.</span><span class="n">Digraph</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;U1&quot;</span><span class="p">,</span> <span class="s2">&quot;covariate&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;U1&quot;</span><span class="p">,</span> <span class="s2">&quot;exposure&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;U2&quot;</span><span class="p">,</span> <span class="s2">&quot;covariate&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;U2&quot;</span><span class="p">,</span> <span class="s2">&quot;outcome&quot;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">edge</span><span class="p">(</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="s2">&quot;outcome&quot;</span><span class="p">)</span>

<span class="n">f</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/8de4c2a37cd1d756c82642726a33e21fdd67cc5e8a9f44f3fc501ecee5c2c3ab.svg"><img alt="../_images/8de4c2a37cd1d756c82642726a33e21fdd67cc5e8a9f44f3fc501ecee5c2c3ab.svg" height="491" src="../_images/8de4c2a37cd1d756c82642726a33e21fdd67cc5e8a9f44f3fc501ecee5c2c3ab.svg" width="731" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">causal_m_bias_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;exposure&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;outcome&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/34f382d32d9889f999ee5c9fc40d1ed66ceab2690e7e5dc365a5ebe7fae72b29.png"><img alt="../_images/34f382d32d9889f999ee5c9fc40d1ed66ceab2690e7e5dc365a5ebe7fae72b29.png" src="../_images/34f382d32d9889f999ee5c9fc40d1ed66ceab2690e7e5dc365a5ebe7fae72b29.png" style="width: 731px; height: 491px;" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate the Pearson correlation between &#39;exposure&#39; and &#39;outcome&#39;</span>
<span class="n">correlation</span> <span class="o">=</span> <span class="n">causal_m_bias_df</span><span class="p">[</span><span class="s1">&#39;exposure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">causal_m_bias_df</span><span class="p">[</span><span class="s1">&#39;outcome&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correlation between &#39;exposure&#39; and &#39;outcome&#39;:&quot;</span><span class="p">,</span> <span class="n">correlation</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation between &#39;exposure&#39; and &#39;outcome&#39;: 0.7241883907049459
</pre></div>
</div>
</div>
</div>
<p>La struttura causale nota come struttura di M-bias (o a volte chiamata struttura a collider aperto) è caratterizzata da due variabili non osservate (<span class="math notranslate nohighlight">\(U1\)</span> e <span class="math notranslate nohighlight">\(U2\)</span>) che influenzano sia la covariata che l’esposizione o l’esito, rispettivamente, oltre al percorso diretto da esposizione a esito. In questo scenario, la covariata è collegata sia all’esposizione che all’esito attraverso le variabili non osservate, formando una struttura a «M».</p>
<section id="id20">
<h3>Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code><a class="headerlink" href="#id20" title="Link to this heading">#</a></h3>
<p>Quando stimiamo l’effetto causale dell’esposizione sull’esito con il modello <span class="math notranslate nohighlight">\(outcome \sim exposure\)</span>, non includiamo la covariata nel modello. In questo caso, stiamo effettivamente ignorando la struttura a «M» e stimando direttamente l’effetto dell’esposizione sull’esito. Poiché il criterio del backdoor ci dice di bloccare i percorsi backdoor per ottenere una stima non distorta dell’effetto causale e non ci sono percorsi backdoor aperti tra esposizione ed esito che passano attraverso le variabili osservate, questo modello fornisce una stima corretta dell’effetto causale di esposizione su esito, assumendo che non ci siano altre variabili confondenti non controllate.</p>
</section>
<section id="id21">
<h3>Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code><a class="headerlink" href="#id21" title="Link to this heading">#</a></h3>
<p>Tuttavia, quando aggiungiamo la covariata al modello (<span class="math notranslate nohighlight">\(outcome \sim exposure + covariate\)</span>), introduciamo potenzialmente un bias nella nostra stima dell’effetto causale. Questo accade perché condizionando sulla covariata, che è al centro della struttura a «M», apriamo un percorso non causale tra esposizione ed esito attraverso le variabili non osservate (<span class="math notranslate nohighlight">\(U1\)</span> e <span class="math notranslate nohighlight">\(U2\)</span>). In altre parole, includere la covariata nel modello crea una correlazione spuria tra esposizione ed esito attraverso le variabili latenti che influenzano sia la covariata che l’esposizione o l’esito.</p>
<p>In un contesto di M-bias, condizionare sulla covariata «apre» il collider (la covariata stessa), che non era un problema quando la covariata non era inclusa nel modello. Questo rende il modello <span class="math notranslate nohighlight">\(outcome \sim exposure + covariate\)</span> inadatto per la stima corretta dell’effetto causale di esposizione su esito in questa specifica struttura causale.</p>
<p>Nel caso di questa struttura casusale, il vero effetto causale di <code class="docutils literal notranslate"><span class="pre">exposure</span></code> su <code class="docutils literal notranslate"><span class="pre">outcome</span></code> è <span class="math notranslate nohighlight">\(\beta\)</span> = 1. Se ignoriamo <code class="docutils literal notranslate"><span class="pre">covariate</span></code> nel modello di regressione otteniamo una stima non distorta del vero effetto causale.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod11</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;outcome ~ exposure&quot;</span><span class="p">,</span> <span class="n">causal_m_bias_df</span><span class="p">)</span>
<span class="n">results11</span> <span class="o">=</span> <span class="n">mod11</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "6f7e3710d89042479e45944f3b0b7285", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "cd2b54c336534d56918b04b076e09d7f", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "2ef55dc0d5954698bc865f85aea60161", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "16d5e241e8eb4621a4f38c642e81d61a", "version_major": 2, "version_minor": 0}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results11</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-0.22</td>
      <td>0.15</td>
      <td>-0.48</td>
      <td>0.07</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4097.99</td>
      <td>2579.64</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>exposure</th>
      <td>1.00</td>
      <td>0.10</td>
      <td>0.82</td>
      <td>1.19</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4169.96</td>
      <td>3087.78</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>outcome_sigma</th>
      <td>1.44</td>
      <td>0.10</td>
      <td>1.25</td>
      <td>1.63</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4213.60</td>
      <td>3197.64</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Se invece usiamo <code class="docutils literal notranslate"><span class="pre">covariate</span></code> come predittore nel modello di regressione otteniamo una stima distorta dell’effetto causale di <code class="docutils literal notranslate"><span class="pre">exposure</span></code> su <code class="docutils literal notranslate"><span class="pre">outcome</span></code>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod11_bis</span> <span class="o">=</span> <span class="n">bmb</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;outcome ~ exposure + covariate&quot;</span><span class="p">,</span> <span class="n">causal_m_bias_df</span><span class="p">)</span>
<span class="n">results11_bis</span> <span class="o">=</span> <span class="n">mod11_bis</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;numpyro&quot;</span><span class="p">,</span> <span class="n">idata_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;log_likelihood&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "beadf0a066694485be47868df2206f15", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "100a221d49704320b62bf189775b125e", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "b930dd10aaab473a9c85868842a98435", "version_major": 2, "version_minor": 0}</script><script type="application/vnd.jupyter.widget-view+json">{"model_id": "967ff7b053b04aa9830a6f0850be3095", "version_major": 2, "version_minor": 0}</script></div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">results11_bis</span><span class="p">,</span> <span class="n">round_to</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hdi_3%</th>
      <th>hdi_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Intercept</th>
      <td>-0.22</td>
      <td>0.15</td>
      <td>-0.48</td>
      <td>0.06</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3911.91</td>
      <td>2567.89</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>covariate</th>
      <td>0.04</td>
      <td>0.03</td>
      <td>-0.01</td>
      <td>0.09</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2463.49</td>
      <td>2677.93</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>exposure</th>
      <td>0.88</td>
      <td>0.13</td>
      <td>0.64</td>
      <td>1.13</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>2751.16</td>
      <td>2691.96</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>outcome_sigma</th>
      <td>1.44</td>
      <td>0.11</td>
      <td>1.25</td>
      <td>1.64</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>3315.05</td>
      <td>2579.48</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In sintesi, in una struttura causale di M-bias, il modello di regressione <span class="math notranslate nohighlight">\(outcome \sim exposure\)</span> senza includere la covariata è preferibile per stimare l’effetto causale dell’esposizione sull’esito, perché evita di introdurre il collider bias che si verificherebbe includendo la covariata nel modello. Questo esempio dimostra l’importanza di considerare attentamente la struttura causale sottostante e il criterio del backdoor quando si sceglie quali variabili includere nei modelli di regressione per la stima degli effetti causali.</p>
</section>
</section>
<section id="riflessioni-conclusive">
<h2>Riflessioni conclusive<a class="headerlink" href="#riflessioni-conclusive" title="Link to this heading">#</a></h2>
<p>In conclusione, esaminando quattro distinti set di dati, riscontriamo che, se non consideriamo le <code class="docutils literal notranslate"><span class="pre">covariate</span></code>, otteniamo consistentemente una stima dell“«effetto medio del trattamento» (ATE) pari a 1. Tuttavia, questo valore di 1 rappresenta una stima corretta dell’effetto causale solo nelle strutture causali del collider e dell’M-bias. In questi casi, non includendo le <code class="docutils literal notranslate"><span class="pre">covariate</span></code>, si ottiene effettvamente una stima non distorta dell’effetto causale dell”<code class="docutils literal notranslate"><span class="pre">esposizione</span></code> sull”<code class="docutils literal notranslate"><span class="pre">esito</span></code>.</p>
<p>Al contrario, se includiamo le <code class="docutils literal notranslate"><span class="pre">covariate</span></code> nell’analisi, osserviamo che le stime dell’ATE risultano distorte: 0.55 nel caso della struttura causale del collider e 0.88 nel caso dell’M-bias.</p>
<p>Quando i dati sono generati da una struttura causale che include un confounder, l’effetto causale corretto è 0.5. Ignorare le <code class="docutils literal notranslate"><span class="pre">covariate</span></code> in questo scenario porta a una stima distorta di 1. Includendole, invece, otteniamo una stima accurata dell’effetto causale reale.</p>
<p>Nel contesto della struttura causale della mediazione, l’effetto totale dell”<code class="docutils literal notranslate"><span class="pre">esposizione</span></code> sull”<code class="docutils literal notranslate"><span class="pre">esito</span></code> è 1, ma l’effetto diretto è 0. Non considerando le <code class="docutils literal notranslate"><span class="pre">covariate</span></code>, la stima dell’effetto totale risulta accurata. Tuttavia, includendo le <code class="docutils literal notranslate"><span class="pre">covariate</span></code>, si ottiene una stima distorta dell’effetto totale, pari a 0.</p>
<p>Queste osservazioni dimostrano che l’inferenza causale non può essere affrontata semplicemente applicando meccanicamente il modello statistico della regressione lineare. Senza ulteriori conoscenze, che non possono essere derivate esclusivamente dai dati osservati, non è possibile ottenere stime non distorte degli effetti causali. Come suggerito dal titolo dell’articolo, l’inferenza causale va oltre le tecniche statistiche: essa richiede informazioni supplementari sulle caratteristiche del fenomeno studiato.</p>
<p>Per trarre conclusioni corrette sui meccanismi causali, è essenziale disporre di informazioni dettagliate sul processo generativo dei dati. Benché spesso queste informazioni non siano direttamente disponibili, i ricercatori possono adottare strategie per minimizzare il rischio di errori interpretativi. Un passo fondamentale consiste nell’identificare ipotetici meccanismi causali prima di procedere con le stime degli effetti, utilizzando diagrammi causali come i grafici aciclici diretti per mappare le relazioni tra le variabili. Questo processo aiuta a determinare quali fattori includere nell’analisi, seguendo il «backdoor criterion» proposto da Judea Pearl, per chiudere i percorsi indiretti tra esposizione ed esito che potrebbero introdurre confondimenti.</p>
<p>In assenza di una comprensione del fenomeno in esame, è cruciale che i ricercatori prestino attenzione all’ordine temporale dei fattori. Questo approccio, fondamentale per l’inferenza causale, implica che l’esposizione avvenga prima dell’esito per stabilire una relazione causale plausibile. Inoltre, è importante che tutte le covariate considerate nell’analisi precedano temporalmente l’esposizione per evitare potenziali bias di specificazione, specialmente nei contesti di collider e mediazione. Seguendo questi principi, i ricercatori possono ridurre il rischio di stime errate degli effetti causali.</p>
</section>
<section id="esercizio">
<h2>Esercizio<a class="headerlink" href="#esercizio" title="Link to this heading">#</a></h2>
<p>Utilizzare i concetti presentati in questo capitolo per analizzare l’articolo selezionato nel contesto del progetto di gruppo.</p>
</section>
<section id="informazioni-sull-ambiente-di-sviluppo">
<h2>Informazioni sull’Ambiente di Sviluppo<a class="headerlink" href="#informazioni-sull-ambiente-di-sviluppo" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> watermark
<span class="o">%</span><span class="k">watermark</span> -n -u -v -iv -w -m
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Last updated: Sun May 12 2024

Python implementation: CPython
Python version       : 3.12.3
IPython version      : 8.22.2

Compiler    : Clang 16.0.6 
OS          : Darwin
Release     : 23.4.0
Machine     : arm64
Processor   : arm
CPU cores   : 8
Architecture: 64bit

bambi      : 0.13.0
rpy2       : 3.5.16
graphviz   : 0.20.3
arviz      : 0.18.0
statsmodels: 0.14.1
seaborn    : 0.13.2
pymc       : 5.14.0
pandas     : 2.2.2
networkx   : 3.3
matplotlib : 3.8.4
numpy      : 1.26.4
scipy      : 1.13.0

Watermark: 2.4.3
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./chapter_5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="05_08_specification_error.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">precedente</p>
        <p class="prev-next-title">Errore di specificazione</p>
      </div>
    </a>
    <a class="right-next"
       href="E_causal_inference.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">successivo</p>
        <p class="prev-next-title">✏️ Esercizi</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenuti
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparazione-del-notebook">Preparazione del Notebook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scopi-della-regressione">Scopi della regressione</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modello-di-regressione-e-analisi-causale">Modello di Regressione e Analisi Causale</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#esempio-1-catena">Esempio 1: Catena</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#esempio-2-biforcazione">Esempio 2: Biforcazione</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#riflessioni-sulle-simulazioni-di-lubke2020we">Riflessioni sulle Simulazioni di <span class="xref cite cite-t">lubke2020we</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#l-inferenza-causale-va-oltre-la-statistica">L’Inferenza Causale Va Oltre la Statistica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#il-criterio-del-backdoor">Il Criterio del Backdoor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#il-quartetto-causale">Il Quartetto Causale</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#collider">Collider</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modello-di-regressione-y-x">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modello-di-regressione-y-x-z">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#confounder">Confounder</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id16">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id17">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mediazione">Mediazione</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id18">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id19">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obiettivo-dell-analisi">Obiettivo dell’analisi</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applicazione-del-criterio-backdoor">Applicazione del Criterio Backdoor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#considerazioni-pratiche">Considerazioni Pratiche</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#causal-m-bias">Causal M-bias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id20">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id21">Modello di regressione <code class="docutils literal notranslate"><span class="pre">Y</span> <span class="pre">~</span> <span class="pre">X</span> <span class="pre">+</span> <span class="pre">Z</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#riflessioni-conclusive">Riflessioni conclusive</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#esercizio">Esercizio</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#informazioni-sull-ambiente-di-sviluppo">Informazioni sull’Ambiente di Sviluppo</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Di Corrado Caudek
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>